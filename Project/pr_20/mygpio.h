/*********************************************************************************************************************
 * @file        mygpio.h
 * @brief       GPIO驱动 - ZF API风格 (适配STM32)
 * @platform    STM32F103C8T6
 *
 * @API设计理念:
 *  1. 简洁易用：gpio_init() 一行代码完成初始化
 *  2. 灵活配置：支持输入/输出/双向模式
 *  3. 统一接口：设置电平、读取电平、翻转电平
********************************************************************************************************************/

#ifndef __MYGPIO_H
#define __MYGPIO_H

#include <stddef.h>
#include <stdint.h>
#include "stm32f10x.h"

/*==================================================================================================================*/
/* =============== 类型定义 =============== */
/*==================================================================================================================*/

/** GPIO引脚枚举 */
typedef enum
{
    // Port A
    PA0 = 0x0001,  PA1 = 0x0002,  PA2 = 0x0004,  PA3 = 0x0008,
    PA4 = 0x0010,  PA5 = 0x0020,  PA6 = 0x0040,  PA7 = 0x0080,
    PA8 = 0x0100,  PA9 = 0x0200,  PA10 = 0x0400, PA11 = 0x0800,
    PA12 = 0x1000, PA13 = 0x2000, PA14 = 0x4000, PA15 = 0x8000,

    // Port B
    PB0 = 0x0101,  PB1 = 0x0102,  PB2 = 0x0104,  PB3 = 0x0108,
    PB4 = 0x0110,  PB5 = 0x0120,  PB6 = 0x0140,  PB7 = 0x0180,
    PB8 = 0x0900,  PB9 = 0x0a00,  PB10 = 0x0c00, PB11 = 0x1000,
    PB12 = 0x2000, PB13 = 0x4000, PB14 = 0x8000, PB15 = 0x0001,

    // Port C
    PC0 = 0x0201,  PC1 = 0x0202,  PC2 = 0x0204,  PC3 = 0x0208,
    PC4 = 0x0210,  PC5 = 0x0220,  PC6 = 0x0240,  PC7 = 0x0280,
    PC8 = 0x0300,  PC9 = 0x0400,  PC10 = 0x0800, PC11 = 0x1000,
    PC12 = 0x2000, PC13 = 0x4000, PC14 = 0x8000, PC15 = 0x0001,

    // Port D
    PD0 = 0x0301,  PD1 = 0x0302,  PD2 = 0x0304,  PD3 = 0x0308,
    PD4 = 0x0310,  PD5 = 0x0320,  PD6 = 0x0340,  PD7 = 0x0380,
    PD8 = 0x0500,  PD9 = 0x0600,  PD10 = 0x0c00, PD11 = 0x1000,
    PD12 = 0x2000, PD13 = 0x4000, PD14 = 0x8000, PD15 = 0x0001,
} gpio_pin_enum;

/** GPIO模式枚举 */
typedef enum
{
    // 输入模式
    GPI_FLOATING_IN = 0x00,    // 浮空输入
    GPI_PULL_DOWN   = 0x02,    // 下拉输入
    GPI_PULL_UP     = 0x03,    // 上拉输入

    // 输出模式
    GPO_PUSH_PULL    = 0x10,   // 推挽输出
    GPO_OPEN_DRAIN   = 0x11,   // 开漏输出

    // 双向GPIO（可读写）
    GPIO_NO_PULL     = 0x20,   // GPIO无上下拉
} gpio_mode_enum;

/** GPIO方向枚举 */
typedef enum
{
    GPI  = 0,   // 输入（准双向）
    GPO  = 1,   // 输出（推挽或开漏）
    GPIO = 2,   // 双向（输入输出）
} gpio_dir_enum;

/** GPIO电平枚举 */
typedef enum
{
    GPIO_LOW  = 0,   // 低电平
    GPIO_HIGH = 1,   // 高电平
} gpio_level_enum;

/** GPIO速度枚举 */
typedef enum
{
    GPIO_SPEED_LOW  = 1,   // 10MHz
    GPIO_SPEED_MED  = 2,   // 2MHz
    GPIO_SPEED_HIGH = 3,   // 50MHz
} gpio_speed_enum;

/*==================================================================================================================*/
/* =============== 宏定义 - 快捷操作 =============== */
/*==================================================================================================================*/

//-------------------------------------------------------------------------------------------------------------------
// 函数简介     设置对应IO 位为低电平
// 参数说明     x           选择操作的引脚 (取值范围在本文件的 gpio_pin_enum 枚举中确定)
// 返回参数     void
// 使用示例     gpio_low(PA0);
// 备注信息
//-------------------------------------------------------------------------------------------------------------------
#define gpio_low(x)             gpio_set_level(x, 0)

//-------------------------------------------------------------------------------------------------------------------
// 函数简介     设置对应IO 位为高电平
// 参数说明     x           选择操作的引脚 (取值范围在本文件的 gpio_pin_enum 枚举中确定)
// 返回参数     void
// 使用示例     gpio_high(PA0);
// 备注信息
//-------------------------------------------------------------------------------------------------------------------
#define gpio_high(x)            gpio_set_level(x, 1)

/*==================================================================================================================*/
/* =============== 函数声明 =============== */
/*==================================================================================================================*/

/**
 * @brief       GPIO初始化
 * @param   pin         引脚选择 (gpio_pin_enum)
 * @param   dir         引脚方向: GPI=输入, GPO=输出, GPIO=双向
 * @param   dat         初始电平状态 (仅输出有效): 0=低电平, 1=高电平
 * @param   mode        GPIO模式: 上拉/下拉/推挽/开漏等
 * @note        自动使能对应端口时钟
 *
 * @example     gpio_init(PA0, GPO, 1, GPO_PUSH_PULL);  // PA0推挽输出，初始高电平
 * @example     gpio_init(PA1, GPI, 0, GPI_PULL_UP);    // PA1上拉输入
 */
void gpio_init(gpio_pin_enum pin, gpio_dir_enum dir, const uint8_t dat, gpio_mode_enum mode);

/**
 * @brief       设置GPIO电平
 * @param   pin         引脚选择
 * @param   dat         0=低电平, 1=高电平
 */
void gpio_set_level(gpio_pin_enum pin, uint8_t dat);

/**
 * @brief       获取GPIO电平
 * @param   pin         引脚选择
 * @return  0=低电平, 1=高电平
 */
uint8_t gpio_get_level(gpio_pin_enum pin);

/**
 * @brief       GPIO电平翻转
 * @param   pin         引脚选择
 */
void gpio_toggle_level(gpio_pin_enum pin);

#endif /* __MYGPIO_H */
