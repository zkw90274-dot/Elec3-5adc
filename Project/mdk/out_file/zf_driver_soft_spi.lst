C251 COMPILER V5.60.0,  zf_driver_soft_spi                                                 08/01/26  02:12:47  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE zf_driver_soft_spi
OBJECT MODULE PLACED IN .\out_file\zf_driver_soft_spi.obj
COMPILER INVOKED BY: E:\Tools\keil5\Keil_v5\C251\BIN\C251.EXE ..\..\libraries\zf_driver\zf_driver_soft_spi.c LARGE NOALI
                    -AS WARNINGLEVEL(3) OPTIMIZE(SIZE) BROWSE INCDIR(..\..\libraries\zf_common;..\..\libraries\zf_components;..\..\libraries\
                    -zf_device;..\..\libraries\zf_driver;..\user;..\code) DEBUG PRINT(.\out_file\zf_driver_soft_spi.lst) TABS(2) OBJECT(.\out
                    -_file\zf_driver_soft_spi.obj) 

stmt  level    source

    1          /********************************************************************************************************
             -*************
    2          * CH32V307VCT6 Opensourec Library å³ï¼ˆCH32V307VCT6 å¼€æºåº“ï¼‰æ˜¯ä¸€ä¸ªåŸºäºå®˜æ–¹ SDK æ¥å£çš„ç¬¬ä¸
             -‰æ–¹å¼€æºåº“
    3          * Copyright (c) 2022 SEEKFREE é€é£ç§‘æŠ€
    4          *
    5          * æœ¬æ–‡ä»¶æ˜¯CH32V307VCT6 å¼€æºåº“çš„ä¸€éƒ¨åˆ†
    6          *
    7          * CH32V307VCT6 å¼€æºåº“ æ˜¯å…è´¹è½¯ä»¶
    8          * æ‚¨å¯ä»¥æ ¹æ®è‡ªç”±è½¯ä»¶åŸºé‡‘ä¼šå‘å¸ƒçš„ GPLï¼ˆGNU General Public Licenseï¼Œå³ GNUé€šç”¨å…¬å…±è®¸
             -å¯è¯ï¼‰çš„æ¡æ¬¾
    9          * å³ GPL çš„ç¬¬3ç‰ˆï¼ˆå³ GPL3.0ï¼‰æˆ–ï¼ˆæ‚¨é€‰æ‹©çš„ï¼‰ä»»ä½•åæ¥çš„ç‰ˆæœ¬ï¼Œé‡æ–°å‘å¸ƒå’Œ/æˆ–ä¿®æ”
             -¹å®ƒ
   10          *
   11          * æœ¬å¼€æºåº“çš„å‘å¸ƒæ˜¯å¸Œæœ›å®ƒèƒ½å‘æŒ¥ä½œç”¨ï¼Œä½†å¹¶æœªå¯¹å…¶ä½œä»»ä½•çš„ä¿è¯
   12          * ç”šè‡³æ²¡æœ‰éšå«çš„é€‚é”€æ€§æˆ–é€‚åˆç‰¹å®šç”¨é€”çš„ä¿è¯
   13          * æ›´å¤šç»†èŠ‚è¯·å‚è§ GPL
   14          *
   15          * æ‚¨åº”è¯¥åœ¨æ”¶åˆ°æœ¬å¼€æºåº“çš„åŒæ—¶æ”¶åˆ°ä¸€ä»½ GPL çš„å‰¯æœ¬
   16          * å¦‚æœæ²¡æœ‰ï¼Œè¯·å‚é˜…<https://www.gnu.org/licenses/>
   17          *
   18          * é¢å¤–æ³¨æ˜ï¼š
   19          * æœ¬å¼€æºåº“ä½¿ç”¨ GPL3.0 å¼€æºè®¸å¯è¯åè®® ä»¥ä¸Šè®¸å¯ç”³æ˜ä¸ºè¯‘æ–‡ç‰ˆæœ¬
   20          * è®¸å¯ç”³æ˜è‹±æ–‡ç‰ˆåœ¨ libraries/doc æ–‡ä»¶å¤¹ä¸‹çš„ GPL3_permission_statement.txt æ–‡ä»¶ä¸­
   21          * è®¸å¯è¯å‰¯æœ¬åœ¨ libraries æ–‡ä»¶å¤¹ä¸‹ å³è¯¥æ–‡ä»¶å¤¹ä¸‹çš„ LICENSE æ–‡ä»¶
   22          * æ¬¢è¿å„ä½ä½¿ç”¨å¹¶ä¼ æ’­æœ¬ç¨‹åº ä½†ä¿®æ”¹å†…å®¹æ—¶å¿…é¡»ä¿ç•™é€é£ç§‘æŠ€çš„ç‰ˆæƒå£°æ˜ï¼ˆå³æœ¬
             -å£°æ˜ï¼‰
   23          *
   24          * æ–‡ä»¶åç§°          zf_driver_soft_spi
   25          * å…¬å¸åç§°          æˆéƒ½é€é£ç§‘æŠ€æœ‰é™å…¬å¸
   26          * ç‰ˆæœ¬ä¿¡æ¯          æŸ¥çœ‹ libraries/doc æ–‡ä»¶å¤¹å†… version æ–‡ä»¶ ç‰ˆæœ¬è¯´æ˜
   27          * å¼€å‘ç¯å¢ƒ          MounRiver Studio V1.8.1
   28          * é€‚ç”¨å¹³å°          CH32V307VCT6
   29          * åº—é“ºé“¾æ¥          https://seekfree.taobao.com/
   30          *
   31          * ä¿®æ”¹è®°å½•
   32          * æ—¥æœŸ                                      ä½œè€…                              å¤‡æ³¨
   33          * 2022-09-15        å¤§W            first version
   34          *********************************************************************************************************
             -***********/
   35          
   36          #include "zf_common_debug.h"
   37          
   38          #include "zf_driver_soft_spi.h"
   39          
   40          //-------------------------------------------------------------------------------------------------------
             -------------
   41          // å‡½æ•°ç®€ä»‹     è½¯ä»¶ SPI å»¶æ—¶
   42          // å‚æ•°è¯´æ˜     void
   43          // è¿”å›å‚æ•°     void
   44          // ä½¿ç”¨ç¤ºä¾‹     //soft_spi_delay(1);
   45          // å¤‡æ³¨ä¿¡æ¯     å†…éƒ¨è°ƒç”¨
   46          //-------------------------------------------------------------------------------------------------------
             -------------
   47          void soft_spi_delay(uint32 x)  
   48          {
C251 COMPILER V5.60.0,  zf_driver_soft_spi                                                 08/01/26  02:12:47  PAGE 2   

   49   1        vuint32 i = x;
   50   1        while(i--);
   51   1      }
   52          
   53          //-------------------------------------------------------------------------------------------------------
             -------------
   54          // å‡½æ•°ç®€ä»‹     è½¯ä»¶ SPI 8bit æ•°æ®è¯»å†™
   55          // å‚æ•°è¯´æ˜     *soft_spi_obj   è½¯ä»¶ SPI æŒ‡å®šä¿¡æ¯å­˜æ”¾ç»“æ„ä½“çš„æŒ‡é’ˆ
   56          // å‚æ•°è¯´æ˜     dat            æ•°æ®
   57          // è¿”å›å‚æ•°     uint8           è¯»å–çš„æ•°æ®
   58          // ä½¿ç”¨ç¤ºä¾‹     soft_spi_8bit_data_handler(soft_spi_obj, 1);
   59          // å¤‡æ³¨ä¿¡æ¯     å†…éƒ¨è°ƒç”¨
   60          //-------------------------------------------------------------------------------------------------------
             -------------
   61          static uint8 soft_spi_8bit_data_handler (soft_spi_info_struct *soft_spi_obj, const uint8 dat)
   62          {
   63   1          uint8 temp = 0;
   64   1          uint8 write_data = dat;
   65   1          uint8 read_data = 0;
   66   1      
   67   1      //    if(soft_spi_obj->config.use_cs)
   68   1      //    {
   69   1      //        gpio_low(soft_spi_obj->cs_pin);
   70   1      //    }
   71   1      
   72   1          if(0 == soft_spi_obj->config.mode || 1 == soft_spi_obj->config.mode)        // CPOL = 0 SCK ç©ºé—²ä½
             -ç”µå¹³
   73   1          {
   74   2              gpio_low(soft_spi_obj->sck_pin);
   75   2          }
   76   1          else                                                                        // CPOL = 1 SCK ç©ºé—²é«˜
             -ç”µå¹³
   77   1          {
   78   2              gpio_high(soft_spi_obj->sck_pin);
   79   2          }
   80   1      
   81   1          if(!(soft_spi_obj->config.mode % 2))                                      // CPHA = 0 ç¬¬ä¸€ä¸ªè¾¹æ²¿
             -é‡‡æ ·
   82   1          {
   83   2              for(temp = 8; temp > 0; temp --)
   84   2              {
   85   3                  if(0x80 & write_data)
   86   3                  {
   87   4                      gpio_high(soft_spi_obj->mosi_pin);
   88   4                  }
   89   3                  else
   90   3                  {
   91   4                      gpio_low(soft_spi_obj->mosi_pin);
   92   4                  }
   93   3                  //soft_spi_delay(soft_spi_obj->delay);
   94   3                  gpio_toggle_level(soft_spi_obj->sck_pin);
   95   3                  write_data = write_data << 1;
   96   3                  read_data = read_data << 1;
   97   3                  if(soft_spi_obj->config.use_miso)
   98   3                  {
   99   4                      read_data |= gpio_get_level(soft_spi_obj->miso_pin);
  100   4                  }
  101   3                  //soft_spi_delay(soft_spi_obj->delay);
  102   3                  gpio_toggle_level(soft_spi_obj->sck_pin);
  103   3              }
  104   2          }
  105   1          else                                                                        // CPHA = 1 ç¬¬äºŒä¸ªè¾¹æ
             -²¿é‡‡æ ·
  106   1          {
  107   2              for(temp = 8; 0 < temp; temp --)
  108   2              {
C251 COMPILER V5.60.0,  zf_driver_soft_spi                                                 08/01/26  02:12:47  PAGE 3   

  109   3                  gpio_toggle_level(soft_spi_obj->sck_pin);
  110   3                  if(0x80 & write_data)
  111   3                  {
  112   4                      gpio_high(soft_spi_obj->mosi_pin);
  113   4                  }
  114   3                  else
  115   3                  {
  116   4                      gpio_low(soft_spi_obj->mosi_pin);
  117   4                  }
  118   3                  //soft_spi_delay(soft_spi_obj->delay);
  119   3                  gpio_toggle_level(soft_spi_obj->sck_pin);
  120   3                  write_data = write_data << 1;
  121   3                  read_data = read_data << 1;
  122   3                  if(soft_spi_obj->config.use_miso)
  123   3                  {
  124   4                      read_data |= gpio_get_level(soft_spi_obj->miso_pin);
  125   4                  }
  126   3                  //soft_spi_delay(soft_spi_obj->delay);
  127   3              }
  128   2          }
  129   1      
  130   1      //    if(soft_spi_obj->config.use_cs)
  131   1      //    {
  132   1      //        gpio_high(soft_spi_obj->cs_pin);
  133   1      //    }
  134   1          return read_data;
  135   1      }
  136          
  137          //-------------------------------------------------------------------------------------------------------
             -------------
  138          // å‡½æ•°ç®€ä»‹     è½¯ä»¶ SPI 16bit æ•°æ®è¯»å†™
  139          // å‚æ•°è¯´æ˜     *soft_spi_obj   è½¯ä»¶ SPI æŒ‡å®šä¿¡æ¯å­˜æ”¾ç»“æ„ä½“çš„æŒ‡é’ˆ
  140          // å‚æ•°è¯´æ˜     dat            æ•°æ®
  141          // è¿”å›å‚æ•°     uint16          è¯»å–çš„æ•°æ®
  142          // ä½¿ç”¨ç¤ºä¾‹     soft_spi_16bit_data_handler(soft_spi_obj, 1);
  143          // å¤‡æ³¨ä¿¡æ¯     å†…éƒ¨è°ƒç”¨
  144          //-------------------------------------------------------------------------------------------------------
             -------------
  145          static uint16 soft_spi_16bit_data_handler (soft_spi_info_struct *soft_spi_obj, const uint16 dat)
  146          {
  147   1          uint8 temp = 0;
  148   1          uint16 write_data = dat;
  149   1          uint16 read_data = 0;
  150   1      
  151   1      //    if(soft_spi_obj->config.use_cs)
  152   1      //    {
  153   1      //        gpio_low(soft_spi_obj->cs_pin);
  154   1      //    }
  155   1      
  156   1          if(0 == soft_spi_obj->config.mode || 1 == soft_spi_obj->config.mode)        // CPOL = 0 SCK ç©ºé—²ä½
             -ç”µå¹³
  157   1          {
  158   2              gpio_low(soft_spi_obj->sck_pin);
  159   2          }
  160   1          else                                                                        // CPOL = 1 SCK ç©ºé—²é«˜
             -ç”µå¹³
  161   1          {
  162   2              gpio_high(soft_spi_obj->sck_pin);
  163   2          }
  164   1      
  165   1          if(!(soft_spi_obj->config.mode % 2))                                      // CPHA = 0 ç¬¬ä¸€ä¸ªè¾¹æ²¿
             -é‡‡æ ·
  166   1          {
  167   2              for(temp = 16; 0 < temp; temp --)
  168   2              {
  169   3                  if(0x8000 & write_data)
C251 COMPILER V5.60.0,  zf_driver_soft_spi                                                 08/01/26  02:12:47  PAGE 4   

  170   3                  {
  171   4                      gpio_high(soft_spi_obj->mosi_pin);
  172   4                  }
  173   3                  else
  174   3                  {
  175   4                      gpio_low(soft_spi_obj->mosi_pin);
  176   4                  }
  177   3                  //soft_spi_delay(soft_spi_obj->delay);
  178   3                  gpio_toggle_level(soft_spi_obj->sck_pin);
  179   3                  write_data = write_data << 1;
  180   3                  read_data = read_data << 1;
  181   3                  if(soft_spi_obj->config.use_miso)
  182   3                  {
  183   4                      read_data |= gpio_get_level(soft_spi_obj->miso_pin);
  184   4                  }
  185   3                  //soft_spi_delay(soft_spi_obj->delay);
  186   3                  gpio_toggle_level(soft_spi_obj->sck_pin);
  187   3              }
  188   2          }
  189   1          else                                                                        // CPHA = 1 ç¬¬äºŒä¸ªè¾¹æ
             -²¿é‡‡æ ·
  190   1          {
  191   2              for(temp = 16; 0 < temp; temp --)
  192   2              {
  193   3                  gpio_toggle_level(soft_spi_obj->sck_pin);
  194   3                  if(write_data & 0x8000)
  195   3                  {
  196   4                      gpio_high(soft_spi_obj->mosi_pin);
  197   4                  }
  198   3                  else
  199   3                  {
  200   4                      gpio_low(soft_spi_obj->mosi_pin);
  201   4                  }
  202   3                  //soft_spi_delay(soft_spi_obj->delay);
  203   3                  gpio_toggle_level(soft_spi_obj->sck_pin);
  204   3                  write_data = write_data << 1;
  205   3                  read_data = read_data << 1;
  206   3                  if(soft_spi_obj->config.use_miso)
  207   3                  {
  208   4                      read_data |= gpio_get_level(soft_spi_obj->miso_pin);
  209   4                  }
  210   3                  //soft_spi_delay(soft_spi_obj->delay);
  211   3              }
  212   2          }
  213   1      
  214   1      //    if(soft_spi_obj->config.use_cs)
  215   1      //    {
  216   1      //        gpio_high(soft_spi_obj->cs_pin);
  217   1      //    }
  218   1          return read_data;
  219   1      }
  220          
  221          //-------------------------------------------------------------------------------------------------------
             -------------
  222          // å‡½æ•°ç®€ä»‹     è½¯ä»¶ SPI æ¥å£å†™ 8bit æ•°æ®
  223          // å‚æ•°è¯´æ˜     *soft_spi_obj   è½¯ä»¶ SPI æŒ‡å®šä¿¡æ¯å­˜æ”¾ç»“æ„ä½“çš„æŒ‡é’ˆ
  224          // å‚æ•°è¯´æ˜     dat            å‘é€çš„æ•°æ®
  225          // è¿”å›å‚æ•°     void
  226          // ä½¿ç”¨ç¤ºä¾‹     soft_spi_write_8bit(&soft_spi_obj, 1);
  227          // å¤‡æ³¨ä¿¡æ¯     
  228          //-------------------------------------------------------------------------------------------------------
             -------------
  229          void soft_spi_write_8bit (soft_spi_info_struct *soft_spi_obj, const uint8 dat)
  230          {
  231   1        zf_assert(soft_spi_obj != NULL);
  232   1        if(soft_spi_obj->config.use_cs)
C251 COMPILER V5.60.0,  zf_driver_soft_spi                                                 08/01/26  02:12:47  PAGE 5   

  233   1          {
  234   2              gpio_low(soft_spi_obj->cs_pin);
  235   2          }
  236   1      
  237   1          soft_spi_8bit_data_handler(soft_spi_obj, dat);
  238   1        
  239   1        if(soft_spi_obj->config.use_cs)
  240   1          {
  241   2              gpio_high(soft_spi_obj->cs_pin);
  242   2          }
  243   1      }
  244          
  245          //-------------------------------------------------------------------------------------------------------
             -------------
  246          // å‡½æ•°ç®€ä»‹     è½¯ä»¶ SPI æ¥å£å†™ 8bit æ•°ç»„
  247          // å‚æ•°è¯´æ˜     *soft_spi_obj   è½¯ä»¶ SPI æŒ‡å®šä¿¡æ¯å­˜æ”¾ç»“æ„ä½“çš„æŒ‡é’ˆ
  248          // å‚æ•°è¯´æ˜     *dat           æ•°æ®å­˜æ”¾ç¼“å†²åŒº
  249          // å‚æ•°è¯´æ˜     len             ç¼“å†²åŒºé•¿åº¦
  250          // è¿”å›å‚æ•°     void
  251          // ä½¿ç”¨ç¤ºä¾‹     soft_spi_write_8bit_array(&soft_spi_obj, buf, 16);
  252          // å¤‡æ³¨ä¿¡æ¯     
  253          //-------------------------------------------------------------------------------------------------------
             -------------
  254          void soft_spi_write_8bit_array (soft_spi_info_struct *soft_spi_obj, const uint8 *dat, uint32 len)
  255          {
  256   1          zf_assert(soft_spi_obj != NULL);
  257   1          zf_assert(dat != NULL);
  258   1        if(soft_spi_obj->config.use_cs)
  259   1          {
  260   2              gpio_low(soft_spi_obj->cs_pin);
  261   2          }
  262   1        
  263   1          while(len --)
  264   1          {
  265   2              soft_spi_8bit_data_handler(soft_spi_obj, *dat ++);
  266   2          }
  267   1        
  268   1        if(soft_spi_obj->config.use_cs)
  269   1          {
  270   2              gpio_high(soft_spi_obj->cs_pin);
  271   2          }
  272   1      }
  273          
  274          //-------------------------------------------------------------------------------------------------------
             -------------
  275          // å‡½æ•°ç®€ä»‹     è½¯ä»¶ SPI æ¥å£å†™ 16bit æ•°æ®
  276          // å‚æ•°è¯´æ˜     *soft_spi_obj   è½¯ä»¶ SPI æŒ‡å®šä¿¡æ¯å­˜æ”¾ç»“æ„ä½“çš„æŒ‡é’ˆ
  277          // å‚æ•°è¯´æ˜     dat            å‘é€çš„æ•°æ®
  278          // è¿”å›å‚æ•°     void
  279          // ä½¿ç”¨ç¤ºä¾‹     soft_spi_write_16bit(&soft_spi_obj, 1);
  280          // å¤‡æ³¨ä¿¡æ¯     
  281          //-------------------------------------------------------------------------------------------------------
             -------------
  282          void soft_spi_write_16bit (soft_spi_info_struct *soft_spi_obj, uint16 dat)
  283          {
  284   1          zf_assert(soft_spi_obj != NULL);
  285   1        if(soft_spi_obj->config.use_cs)
  286   1          {
  287   2              gpio_low(soft_spi_obj->cs_pin);
  288   2          }
  289   1        
  290   1          soft_spi_16bit_data_handler(soft_spi_obj, dat);
  291   1        
  292   1        if(soft_spi_obj->config.use_cs)
  293   1          {
  294   2              gpio_high(soft_spi_obj->cs_pin);
C251 COMPILER V5.60.0,  zf_driver_soft_spi                                                 08/01/26  02:12:47  PAGE 6   

  295   2          }
  296   1      }
  297          
  298          //-------------------------------------------------------------------------------------------------------
             -------------
  299          // å‡½æ•°ç®€ä»‹     è½¯ä»¶ SPI æ¥å£å†™ 16bit æ•°ç»„
  300          // å‚æ•°è¯´æ˜     *soft_spi_obj   è½¯ä»¶ SPI æŒ‡å®šä¿¡æ¯å­˜æ”¾ç»“æ„ä½“çš„æŒ‡é’ˆ
  301          // å‚æ•°è¯´æ˜     *dat           æ•°æ®å­˜æ”¾ç¼“å†²åŒº
  302          // å‚æ•°è¯´æ˜     len             ç¼“å†²åŒºé•¿åº¦
  303          // è¿”å›å‚æ•°     void
  304          // ä½¿ç”¨ç¤ºä¾‹     soft_spi_write_16bit_array(&soft_spi_obj, buf, 16);
  305          // å¤‡æ³¨ä¿¡æ¯     
  306          //-------------------------------------------------------------------------------------------------------
             -------------
  307          void soft_spi_write_16bit_array (soft_spi_info_struct *soft_spi_obj, const uint16 *dat, uint32 len)
  308          {
  309   1          zf_assert(soft_spi_obj != NULL);
  310   1          zf_assert(dat != NULL);
  311   1        if(soft_spi_obj->config.use_cs)
  312   1          {
  313   2              gpio_low(soft_spi_obj->cs_pin);
  314   2          }
  315   1        
  316   1          while(len --)
  317   1          {
  318   2              soft_spi_16bit_data_handler(soft_spi_obj, *dat ++);
  319   2          }
  320   1        
  321   1        if(soft_spi_obj->config.use_cs)
  322   1          {
  323   2              gpio_high(soft_spi_obj->cs_pin);
  324   2          }
  325   1      }
  326          
  327          //-------------------------------------------------------------------------------------------------------
             -------------
  328          // å‡½æ•°ç®€ä»‹     è½¯ä»¶ SPI æ¥å£å‘ä¼ æ„Ÿå™¨çš„å¯„å­˜å™¨å†™ 8bit æ•°æ®
  329          // å‚æ•°è¯´æ˜     *soft_spi_obj   è½¯ä»¶ SPI æŒ‡å®šä¿¡æ¯å­˜æ”¾ç»“æ„ä½“çš„æŒ‡é’ˆ
  330          // å‚æ•°è¯´æ˜     register_name   å¯„å­˜å™¨åœ°å€
  331          // å‚æ•°è¯´æ˜     dat            å‘é€çš„æ•°æ®
  332          // è¿”å›å‚æ•°     void
  333          // ä½¿ç”¨ç¤ºä¾‹     soft_spi_write_8bit_register(&soft_spi_obj, 1, 1);
  334          // å¤‡æ³¨ä¿¡æ¯     
  335          //-------------------------------------------------------------------------------------------------------
             -------------
  336          void soft_spi_write_8bit_register (soft_spi_info_struct *soft_spi_obj, const uint8 register_name, const u
             -int8 dat)
  337          {
  338   1          zf_assert(soft_spi_obj != NULL);
  339   1        if(soft_spi_obj->config.use_cs)
  340   1          {
  341   2              gpio_low(soft_spi_obj->cs_pin);
  342   2          }
  343   1        
  344   1          soft_spi_8bit_data_handler(soft_spi_obj, register_name);
  345   1          soft_spi_8bit_data_handler(soft_spi_obj, dat);
  346   1        
  347   1        if(soft_spi_obj->config.use_cs)
  348   1          {
  349   2              gpio_high(soft_spi_obj->cs_pin);
  350   2          }
  351   1      }
  352          
  353          //-------------------------------------------------------------------------------------------------------
             -------------
  354          // å‡½æ•°ç®€ä»‹     è½¯ä»¶ SPI æ¥å£å‘ä¼ æ„Ÿå™¨çš„å¯„å­˜å™¨å†™ 8bit æ•°ç»„
C251 COMPILER V5.60.0,  zf_driver_soft_spi                                                 08/01/26  02:12:47  PAGE 7   

  355          // å‚æ•°è¯´æ˜     *soft_spi_obj   è½¯ä»¶ SPI æŒ‡å®šä¿¡æ¯å­˜æ”¾ç»“æ„ä½“çš„æŒ‡é’ˆ
  356          // å‚æ•°è¯´æ˜     register_name   å¯„å­˜å™¨åœ°å€
  357          // å‚æ•°è¯´æ˜     *dat           æ•°æ®å­˜æ”¾ç¼“å†²åŒº
  358          // å‚æ•°è¯´æ˜     len             ç¼“å†²åŒºé•¿åº¦
  359          // è¿”å›å‚æ•°     void
  360          // ä½¿ç”¨ç¤ºä¾‹     soft_spi_write_8bit_registers(&soft_spi_obj, 1, buf, 16);
  361          //-------------------------------------------------------------------------------------------------------
             -------------
  362          void soft_spi_write_8bit_registers (soft_spi_info_struct *soft_spi_obj, const uint8 register_name, const 
             -uint8 *dat, uint32 len)
  363          {
  364   1          zf_assert(soft_spi_obj != NULL);
  365   1          zf_assert(dat != NULL);
  366   1        if(soft_spi_obj->config.use_cs)
  367   1          {
  368   2              gpio_low(soft_spi_obj->cs_pin);
  369   2          }
  370   1        
  371   1          soft_spi_8bit_data_handler(soft_spi_obj, register_name);
  372   1          while(len --)
  373   1          {
  374   2              soft_spi_8bit_data_handler(soft_spi_obj, *dat ++);
  375   2          }
  376   1        
  377   1        if(soft_spi_obj->config.use_cs)
  378   1          {
  379   2              gpio_high(soft_spi_obj->cs_pin);
  380   2          }
  381   1      }
  382          
  383          //-------------------------------------------------------------------------------------------------------
             -------------
  384          // å‡½æ•°ç®€ä»‹     è½¯ä»¶ SPI æ¥å£å‘ä¼ æ„Ÿå™¨çš„å¯„å­˜å™¨å†™ 16bit æ•°æ®
  385          // å‚æ•°è¯´æ˜     *soft_spi_obj   è½¯ä»¶ SPI æŒ‡å®šä¿¡æ¯å­˜æ”¾ç»“æ„ä½“çš„æŒ‡é’ˆ
  386          // å‚æ•°è¯´æ˜     register_name   å¯„å­˜å™¨åœ°å€
  387          // å‚æ•°è¯´æ˜     dat            å‘é€çš„æ•°æ®
  388          // è¿”å›å‚æ•°     void
  389          // ä½¿ç”¨ç¤ºä¾‹     soft_spi_write_16bit_register(&soft_spi_obj, 1, 1);
  390          // å¤‡æ³¨ä¿¡æ¯     
  391          //-------------------------------------------------------------------------------------------------------
             -------------
  392          void soft_spi_write_16bit_register (soft_spi_info_struct *soft_spi_obj, const uint16 register_name, uint1
             -6 dat)
  393          {
  394   1          zf_assert(soft_spi_obj != NULL);
  395   1        if(soft_spi_obj->config.use_cs)
  396   1          {
  397   2              gpio_low(soft_spi_obj->cs_pin);
  398   2          }
  399   1        
  400   1          soft_spi_16bit_data_handler(soft_spi_obj, register_name);
  401   1          soft_spi_16bit_data_handler(soft_spi_obj, dat);
  402   1        
  403   1        if(soft_spi_obj->config.use_cs)
  404   1          {
  405   2              gpio_high(soft_spi_obj->cs_pin);
  406   2          }
  407   1      }
  408          
  409          //-------------------------------------------------------------------------------------------------------
             -------------
  410          // å‡½æ•°ç®€ä»‹     è½¯ä»¶ SPI æ¥å£å‘ä¼ æ„Ÿå™¨çš„å¯„å­˜å™¨å†™ 16bit æ•°ç»„
  411          // å‚æ•°è¯´æ˜     *soft_spi_obj   è½¯ä»¶ SPI æŒ‡å®šä¿¡æ¯å­˜æ”¾ç»“æ„ä½“çš„æŒ‡é’ˆ
  412          // å‚æ•°è¯´æ˜     register_name   å¯„å­˜å™¨åœ°å€
  413          // å‚æ•°è¯´æ˜     *dat           æ•°æ®å­˜æ”¾ç¼“å†²åŒº
  414          // å‚æ•°è¯´æ˜     len             ç¼“å†²åŒºé•¿åº¦
C251 COMPILER V5.60.0,  zf_driver_soft_spi                                                 08/01/26  02:12:47  PAGE 8   

  415          // è¿”å›å‚æ•°     void
  416          // ä½¿ç”¨ç¤ºä¾‹     soft_spi_write_16bit_registers(&soft_spi_obj, 1, buf, 16);
  417          // å¤‡æ³¨ä¿¡æ¯     
  418          //-------------------------------------------------------------------------------------------------------
             -------------
  419          void soft_spi_write_16bit_registers (soft_spi_info_struct *soft_spi_obj, const uint16 register_name, cons
             -t uint16 *dat, uint32 len)
  420          {
  421   1          zf_assert(soft_spi_obj != NULL);
  422   1          zf_assert(dat != NULL);
  423   1        if(soft_spi_obj->config.use_cs)
  424   1          {
  425   2              gpio_low(soft_spi_obj->cs_pin);
  426   2          }
  427   1        
  428   1          soft_spi_16bit_data_handler(soft_spi_obj, register_name);
  429   1          while(len --)
  430   1          {
  431   2              soft_spi_16bit_data_handler(soft_spi_obj, *dat ++);
  432   2          }
  433   1        
  434   1        if(soft_spi_obj->config.use_cs)
  435   1          {
  436   2              gpio_high(soft_spi_obj->cs_pin);
  437   2          }
  438   1      }
  439          
  440          //-------------------------------------------------------------------------------------------------------
             -------------
  441          // å‡½æ•°ç®€ä»‹     è½¯ä»¶ SPI æ¥å£è¯» 8bit æ•°æ®
  442          // å‚æ•°è¯´æ˜     *soft_spi_obj   è½¯ä»¶ SPI æŒ‡å®šä¿¡æ¯å­˜æ”¾ç»“æ„ä½“çš„æŒ‡é’ˆ
  443          // å‚æ•°è¯´æ˜     dat            å‘é€çš„æ•°æ®
  444          // è¿”å›å‚æ•°     uint8           è¿”å›è¯»å–çš„ 8bit æ•°æ®
  445          // ä½¿ç”¨ç¤ºä¾‹     soft_spi_read_8bit(&soft_spi_obj);
  446          // å¤‡æ³¨ä¿¡æ¯     
  447          //-------------------------------------------------------------------------------------------------------
             -------------
  448          uint8 soft_spi_read_8bit (soft_spi_info_struct *soft_spi_obj)
  449          {
  450   1        uint8 dat = 0;
  451   1          zf_assert(soft_spi_obj != NULL);
  452   1        if(soft_spi_obj->config.use_cs)
  453   1          {
  454   2              gpio_low(soft_spi_obj->cs_pin);
  455   2          }
  456   1        
  457   1        dat = soft_spi_8bit_data_handler(soft_spi_obj, 0);
  458   1      
  459   1        if(soft_spi_obj->config.use_cs)
  460   1          {
  461   2              gpio_high(soft_spi_obj->cs_pin);
  462   2          }
  463   1          return dat;
  464   1      }
  465          
  466          //-------------------------------------------------------------------------------------------------------
             -------------
  467          // å‡½æ•°ç®€ä»‹     è½¯ä»¶ SPI æ¥å£è¯» 8bit æ•°ç»„
  468          // å‚æ•°è¯´æ˜     *soft_spi_obj   è½¯ä»¶ SPI æŒ‡å®šä¿¡æ¯å­˜æ”¾ç»“æ„ä½“çš„æŒ‡é’ˆ
  469          // å‚æ•°è¯´æ˜     *dat           æ•°æ®å­˜æ”¾ç¼“å†²åŒº
  470          // å‚æ•°è¯´æ˜     len             ç¼“å†²åŒºé•¿åº¦
  471          // è¿”å›å‚æ•°     void
  472          // ä½¿ç”¨ç¤ºä¾‹     soft_spi_read_8bit_array(&soft_spi_obj, buf, 16);
  473          // å¤‡æ³¨ä¿¡æ¯     
  474          //-------------------------------------------------------------------------------------------------------
             -------------
C251 COMPILER V5.60.0,  zf_driver_soft_spi                                                 08/01/26  02:12:47  PAGE 9   

  475          void soft_spi_read_8bit_array (soft_spi_info_struct *soft_spi_obj, uint8 *dat, uint32 len)
  476          {
  477   1          zf_assert(soft_spi_obj != NULL);
  478   1          zf_assert(dat != NULL);
  479   1        if(soft_spi_obj->config.use_cs)
  480   1          {
  481   2              gpio_low(soft_spi_obj->cs_pin);
  482   2          }
  483   1        
  484   1          while(len --)
  485   1          {
  486   2              *dat ++ = soft_spi_8bit_data_handler(soft_spi_obj, 0);
  487   2          }
  488   1        
  489   1        if(soft_spi_obj->config.use_cs)
  490   1          {
  491   2              gpio_high(soft_spi_obj->cs_pin);
  492   2          }
  493   1      }
  494          
  495          //-------------------------------------------------------------------------------------------------------
             -------------
  496          // å‡½æ•°ç®€ä»‹     è½¯ä»¶ SPI æ¥å£è¯» 16bit æ•°æ®
  497          // å‚æ•°è¯´æ˜     *soft_spi_obj   è½¯ä»¶ SPI æŒ‡å®šä¿¡æ¯å­˜æ”¾ç»“æ„ä½“çš„æŒ‡é’ˆ
  498          // å‚æ•°è¯´æ˜     dat            å‘é€çš„æ•°æ®
  499          // è¿”å›å‚æ•°     uint16          è¿”å›è¯»å–çš„ 16bit æ•°æ®
  500          // ä½¿ç”¨ç¤ºä¾‹     soft_spi_read_16bit(&soft_spi_obj);
  501          // å¤‡æ³¨ä¿¡æ¯     
  502          //-------------------------------------------------------------------------------------------------------
             -------------
  503          uint16 soft_spi_read_16bit (soft_spi_info_struct *soft_spi_obj)
  504          {
  505   1        uint8 dat = 0;
  506   1        
  507   1        zf_assert(soft_spi_obj != NULL);
  508   1        
  509   1        if(soft_spi_obj->config.use_cs)
  510   1          {
  511   2              gpio_low(soft_spi_obj->cs_pin);
  512   2          }
  513   1        
  514   1        dat = soft_spi_16bit_data_handler(soft_spi_obj, 0);
  515   1        
  516   1        if(soft_spi_obj->config.use_cs)
  517   1          {
  518   2              gpio_high(soft_spi_obj->cs_pin);
  519   2          }
  520   1        
  521   1          return dat;
  522   1      }
  523          
  524          //-------------------------------------------------------------------------------------------------------
             -------------
  525          // å‡½æ•°ç®€ä»‹     è½¯ä»¶ SPI æ¥å£è¯» 16bit æ•°ç»„
  526          // å‚æ•°è¯´æ˜     *soft_spi_obj   è½¯ä»¶ SPI æŒ‡å®šä¿¡æ¯å­˜æ”¾ç»“æ„ä½“çš„æŒ‡é’ˆ
  527          // å‚æ•°è¯´æ˜     *dat           æ•°æ®å­˜æ”¾ç¼“å†²åŒº
  528          // å‚æ•°è¯´æ˜     len             ç¼“å†²åŒºé•¿åº¦
  529          // è¿”å›å‚æ•°     void
  530          // ä½¿ç”¨ç¤ºä¾‹     soft_spi_read_16bit_array(&soft_spi_obj, buf, 16);
  531          // å¤‡æ³¨ä¿¡æ¯     
  532          //-------------------------------------------------------------------------------------------------------
             -------------
  533          void soft_spi_read_16bit_array (soft_spi_info_struct *soft_spi_obj, uint16 *dat, uint32 len)
  534          {
  535   1          zf_assert(soft_spi_obj != NULL);
  536   1          zf_assert(dat != NULL);
C251 COMPILER V5.60.0,  zf_driver_soft_spi                                                 08/01/26  02:12:47  PAGE 10  

  537   1        if(soft_spi_obj->config.use_cs)
  538   1          {
  539   2              gpio_low(soft_spi_obj->cs_pin);
  540   2          }
  541   1        
  542   1          while(len --)
  543   1          {
  544   2              *dat ++ = soft_spi_16bit_data_handler(soft_spi_obj, 0);
  545   2          }
  546   1        
  547   1        if(soft_spi_obj->config.use_cs)
  548   1          {
  549   2              gpio_high(soft_spi_obj->cs_pin);
  550   2          }
  551   1      }
  552          
  553          //-------------------------------------------------------------------------------------------------------
             -------------
  554          // å‡½æ•°ç®€ä»‹     è½¯ä»¶ SPI æ¥å£ä»ä¼ æ„Ÿå™¨çš„å¯„å­˜å™¨è¯» 8bit æ•°æ®
  555          // å‚æ•°è¯´æ˜     *soft_spi_obj   è½¯ä»¶ SPI æŒ‡å®šä¿¡æ¯å­˜æ”¾ç»“æ„ä½“çš„æŒ‡é’ˆ
  556          // å‚æ•°è¯´æ˜     register_name   å¯„å­˜å™¨åœ°å€
  557          // å‚æ•°è¯´æ˜     dat            å‘é€çš„æ•°æ®
  558          // è¿”å›å‚æ•°     uint8           è¿”å›è¯»å–çš„ 8bit æ•°æ®
  559          // ä½¿ç”¨ç¤ºä¾‹     soft_spi_read_8bit_register(&soft_spi_obj, 0x01, 0x01);
  560          // å¤‡æ³¨ä¿¡æ¯     
  561          //-------------------------------------------------------------------------------------------------------
             -------------
  562          uint8 soft_spi_read_8bit_register (soft_spi_info_struct *soft_spi_obj, const uint8 register_name)
  563          {
  564   1        uint8 dat = 0;
  565   1          zf_assert(soft_spi_obj != NULL);
  566   1        if(soft_spi_obj->config.use_cs)
  567   1          {
  568   2              gpio_low(soft_spi_obj->cs_pin);
  569   2          }
  570   1        
  571   1          soft_spi_8bit_data_handler(soft_spi_obj, register_name);
  572   1        dat = soft_spi_8bit_data_handler(soft_spi_obj, 0);
  573   1        
  574   1        if(soft_spi_obj->config.use_cs)
  575   1          {
  576   2              gpio_high(soft_spi_obj->cs_pin);
  577   2          }
  578   1          return dat;
  579   1      }
  580          
  581          //-------------------------------------------------------------------------------------------------------
             -------------
  582          // å‡½æ•°ç®€ä»‹     è½¯ä»¶ SPI æ¥å£ä»ä¼ æ„Ÿå™¨çš„å¯„å­˜å™¨è¯» 8bit æ•°ç»„
  583          // å‚æ•°è¯´æ˜     *soft_spi_obj   è½¯ä»¶ SPI æŒ‡å®šä¿¡æ¯å­˜æ”¾ç»“æ„ä½“çš„æŒ‡é’ˆ
  584          // å‚æ•°è¯´æ˜     register_name   å¯„å­˜å™¨åœ°å€
  585          // å‚æ•°è¯´æ˜     *dat           æ•°æ®å­˜æ”¾ç¼“å†²åŒº
  586          // å‚æ•°è¯´æ˜     len             ç¼“å†²åŒºé•¿åº¦
  587          // è¿”å›å‚æ•°     void
  588          // ä½¿ç”¨ç¤ºä¾‹     soft_spi_read_8bit_registers(&soft_spi_obj, 0x01, buf, 16);
  589          // å¤‡æ³¨ä¿¡æ¯     
  590          //-------------------------------------------------------------------------------------------------------
             -------------
  591          void soft_spi_read_8bit_registers (soft_spi_info_struct *soft_spi_obj, const uint8 register_name, uint8 *
             -dat, uint32 len)
  592          {
  593   1          zf_assert(soft_spi_obj != NULL);
  594   1          zf_assert(dat != NULL);
  595   1        if(soft_spi_obj->config.use_cs)
  596   1          {
  597   2              gpio_low(soft_spi_obj->cs_pin);
C251 COMPILER V5.60.0,  zf_driver_soft_spi                                                 08/01/26  02:12:47  PAGE 11  

  598   2          }
  599   1        
  600   1          soft_spi_8bit_data_handler(soft_spi_obj, register_name);
  601   1          while(len --)
  602   1          {
  603   2              *dat ++ = soft_spi_8bit_data_handler(soft_spi_obj, 0);
  604   2          }
  605   1        
  606   1        if(soft_spi_obj->config.use_cs)
  607   1          {
  608   2              gpio_high(soft_spi_obj->cs_pin);
  609   2          }
  610   1      }
  611          
  612          //-------------------------------------------------------------------------------------------------------
             -------------
  613          // å‡½æ•°ç®€ä»‹     è½¯ä»¶ SPI æ¥å£ä»ä¼ æ„Ÿå™¨çš„å¯„å­˜å™¨è¯» 16bit æ•°æ®
  614          // å‚æ•°è¯´æ˜     *soft_spi_obj   è½¯ä»¶ SPI æŒ‡å®šä¿¡æ¯å­˜æ”¾ç»“æ„ä½“çš„æŒ‡é’ˆ
  615          // å‚æ•°è¯´æ˜     register_name   å¯„å­˜å™¨åœ°å€
  616          // å‚æ•°è¯´æ˜     dat            å‘é€çš„æ•°æ®
  617          // è¿”å›å‚æ•°     uint16          è¿”å›è¯»å–çš„ 16bit æ•°æ®
  618          // ä½¿ç”¨ç¤ºä¾‹     soft_spi_read_16bit_register(&soft_spi_obj, 0x0101);
  619          // å¤‡æ³¨ä¿¡æ¯     
  620          //-------------------------------------------------------------------------------------------------------
             -------------
  621          uint16 soft_spi_read_16bit_register (soft_spi_info_struct *soft_spi_obj, const uint16 register_name)
  622          {
  623   1        uint16 dat = 0;
  624   1        
  625   1          zf_assert(soft_spi_obj != NULL);
  626   1        
  627   1        if(soft_spi_obj->config.use_cs)
  628   1          {
  629   2              gpio_low(soft_spi_obj->cs_pin);
  630   2          }
  631   1          soft_spi_16bit_data_handler(soft_spi_obj, register_name);
  632   1        dat = soft_spi_16bit_data_handler(soft_spi_obj, 0);
  633   1        
  634   1        if(soft_spi_obj->config.use_cs)
  635   1          {
  636   2              gpio_high(soft_spi_obj->cs_pin);
  637   2          }
  638   1          return dat;
  639   1      }
  640          
  641          //-------------------------------------------------------------------------------------------------------
             -------------
  642          // å‡½æ•°ç®€ä»‹     è½¯ä»¶ SPI æ¥å£ä»ä¼ æ„Ÿå™¨çš„å¯„å­˜å™¨è¯» 16bit æ•°ç»„
  643          // å‚æ•°è¯´æ˜     *soft_spi_obj   è½¯ä»¶ SPI æŒ‡å®šä¿¡æ¯å­˜æ”¾ç»“æ„ä½“çš„æŒ‡é’ˆ
  644          // å‚æ•°è¯´æ˜     register_name   å¯„å­˜å™¨åœ°å€
  645          // å‚æ•°è¯´æ˜     *dat           æ•°æ®å­˜æ”¾ç¼“å†²åŒº
  646          // å‚æ•°è¯´æ˜     len             ç¼“å†²åŒºé•¿åº¦
  647          // è¿”å›å‚æ•°     void
  648          // ä½¿ç”¨ç¤ºä¾‹     soft_spi_read_16bit_registers(&soft_spi_obj, 0x0101, buf, 16);
  649          // å¤‡æ³¨ä¿¡æ¯     
  650          //-------------------------------------------------------------------------------------------------------
             -------------
  651          void soft_spi_read_16bit_registers (soft_spi_info_struct *soft_spi_obj, const uint16 register_name, uint1
             -6 *dat, uint32 len)
  652          {
  653   1          zf_assert(soft_spi_obj != NULL);
  654   1          zf_assert(dat != NULL);
  655   1        if(soft_spi_obj->config.use_cs)
  656   1          {
  657   2              gpio_low(soft_spi_obj->cs_pin);
  658   2          }
C251 COMPILER V5.60.0,  zf_driver_soft_spi                                                 08/01/26  02:12:47  PAGE 12  

  659   1          soft_spi_16bit_data_handler(soft_spi_obj, register_name);
  660   1          while(len --)
  661   1          {
  662   2              *dat ++ = soft_spi_16bit_data_handler(soft_spi_obj, 0);
  663   2          }
  664   1        
  665   1        if(soft_spi_obj->config.use_cs)
  666   1          {
  667   2              gpio_high(soft_spi_obj->cs_pin);
  668   2          }
  669   1      }
  670          
  671          //-------------------------------------------------------------------------------------------------------
             -------------
  672          // å‡½æ•°ç®€ä»‹     è½¯ä»¶ SPI 8bit æ•°æ®ä¼ è¾“ å‘é€ä¸æ¥æ”¶æ•°æ®æ˜¯åŒæ—¶è¿›è¡Œçš„
  673          // å‚æ•°è¯´æ˜     *soft_spi_obj   è½¯ä»¶ SPI æŒ‡å®šä¿¡æ¯å­˜æ”¾ç»“æ„ä½“çš„æŒ‡é’ˆ
  674          // å‚æ•°è¯´æ˜     write_buffer    å‘é€çš„æ•°æ®ç¼“å†²åŒºåœ°å€
  675          // å‚æ•°è¯´æ˜     read_buffer     å‘é€æ•°æ®æ—¶æ¥æ”¶åˆ°çš„æ•°æ®çš„å­˜å‚¨åœ°å€(ä¸éœ€è¦æ¥æ”¶åˆ™ä¼
             -  NULL)
  676          // å‚æ•°è¯´æ˜     len             å‘é€çš„å­—èŠ‚æ•°
  677          // è¿”å›å‚æ•°     void
  678          // ä½¿ç”¨ç¤ºä¾‹     soft_spi_transfer_8bit(&soft_spi_obj, buf, buf, 1);
  679          // å¤‡æ³¨ä¿¡æ¯     
  680          //-------------------------------------------------------------------------------------------------------
             -------------
  681          void soft_spi_transfer_8bit (soft_spi_info_struct *soft_spi_obj, const uint8 *write_buffer, uint8 *read_b
             -uffer, uint32 len)
  682          {
  683   1          zf_assert(soft_spi_obj != NULL);
  684   1          zf_assert(write_buffer != NULL);
  685   1        if(soft_spi_obj->config.use_cs)
  686   1          {
  687   2              gpio_low(soft_spi_obj->cs_pin);
  688   2          }
  689   1        
  690   1          while(len --)
  691   1          {
  692   2              if(read_buffer != NULL)
  693   2              {
  694   3                  *read_buffer = soft_spi_8bit_data_handler(soft_spi_obj, *write_buffer);
  695   3                  write_buffer ++;
  696   3                  read_buffer ++;
  697   3              }
  698   2              else
  699   2              {
  700   3                  soft_spi_8bit_data_handler(soft_spi_obj, *write_buffer);
  701   3                  write_buffer ++;
  702   3              }
  703   2          }
  704   1        
  705   1        if(soft_spi_obj->config.use_cs)
  706   1          {
  707   2              gpio_high(soft_spi_obj->cs_pin);
  708   2          }
  709   1      }
  710          
  711          //-------------------------------------------------------------------------------------------------------
             -------------
  712          // å‡½æ•°ç®€ä»‹     è½¯ä»¶ SPI 16bit æ•°æ®ä¼ è¾“ å‘é€ä¸æ¥æ”¶æ•°æ®æ˜¯åŒæ—¶è¿›è¡Œçš„
  713          // å‚æ•°è¯´æ˜     *soft_spi_obj   è½¯ä»¶ SPI æŒ‡å®šä¿¡æ¯å­˜æ”¾ç»“æ„ä½“çš„æŒ‡é’ˆ
  714          // å‚æ•°è¯´æ˜     write_buffer    å‘é€çš„æ•°æ®ç¼“å†²åŒºåœ°å€
  715          // å‚æ•°è¯´æ˜     read_buffer     å‘é€æ•°æ®æ—¶æ¥æ”¶åˆ°çš„æ•°æ®çš„å­˜å‚¨åœ°å€(ä¸éœ€è¦æ¥æ”¶åˆ™ä¼
             -  NULL)
  716          // å‚æ•°è¯´æ˜     len             å‘é€çš„å­—èŠ‚æ•°
  717          // è¿”å›å‚æ•°     void
  718          // ä½¿ç”¨ç¤ºä¾‹     soft_spi_transfer_16bit(&soft_spi_obj, buf, buf, 1);
C251 COMPILER V5.60.0,  zf_driver_soft_spi                                                 08/01/26  02:12:47  PAGE 13  

  719          // å¤‡æ³¨ä¿¡æ¯     
  720          //-------------------------------------------------------------------------------------------------------
             -------------
  721          void soft_spi_transfer_16bit (soft_spi_info_struct *soft_spi_obj, const uint16 *write_buffer, uint16 *rea
             -d_buffer, uint32 len)
  722          {
  723   1          zf_assert(soft_spi_obj != NULL);
  724   1          zf_assert(write_buffer != NULL);
  725   1        if(soft_spi_obj->config.use_cs)
  726   1          {
  727   2              gpio_low(soft_spi_obj->cs_pin);
  728   2          }
  729   1        
  730   1          while(len --)
  731   1          {
  732   2              if(read_buffer != NULL)
  733   2              {
  734   3                  *read_buffer = soft_spi_16bit_data_handler(soft_spi_obj, *write_buffer);
  735   3                  write_buffer ++;
  736   3                  read_buffer ++;
  737   3              }
  738   2              else
  739   2              {
  740   3                  soft_spi_16bit_data_handler(soft_spi_obj, *write_buffer);
  741   3                  write_buffer ++;
  742   3              }
  743   2          }
  744   1        
  745   1        if(soft_spi_obj->config.use_cs)
  746   1          {
  747   2              gpio_high(soft_spi_obj->cs_pin);
  748   2          }
  749   1      }
  750          
  751          //-------------------------------------------------------------------------------------------------------
             -------------
  752          // å‡½æ•°ç®€ä»‹     è½¯ä»¶ SPI æ¥å£åˆå§‹åŒ–
  753          // å‚æ•°è¯´æ˜     *soft_spi_obj   è½¯ä»¶ SPI æŒ‡å®šä¿¡æ¯å­˜æ”¾ç»“æ„ä½“çš„æŒ‡é’ˆ
  754          // å‚æ•°è¯´æ˜     mode            SPI æ¨¡å¼ å‚ç…§ zf_driver_spi.h å†… spi_mode_enum æšä¸¾ä½“å®šä¹‰
  755          // å‚æ•°è¯´æ˜     delay           è½¯ä»¶ SPI å»¶æ—¶ å°±æ˜¯æ—¶é’Ÿé«˜ç”µå¹³æ—¶é—´ è¶ŠçŸ­ SPI é€Ÿç‡è¶Šé«˜
  756          // å‚æ•°è¯´æ˜     sck_pin         é€‰æ‹© SCK å¼•è„š å‚ç…§ zf_driver_gpio.h å†… gpio_pin_enum æšä¸¾ä½“
             -å®šä¹‰
  757          // å‚æ•°è¯´æ˜     mosi_pin        é€‰æ‹© MOSI å¼•è„š å‚ç…§ zf_driver_gpio.h å†… gpio_pin_enum æšä¸¾ä½
             -“å®šä¹‰
  758          // å‚æ•°è¯´æ˜     miso_pin        é€‰æ‹© MISO å¼•è„š å¦‚æœä¸éœ€è¦è¿™ä¸ªå¼•è„š å°±å¡« SOFT_SPI_PIN_NU
             -LL
  759          // å‚æ•°è¯´æ˜     cs_pin          é€‰æ‹© CS å¼•è„š å¦‚æœä¸éœ€è¦è¿™ä¸ªå¼•è„š å°±å¡« SOFT_SPI_PIN_NULL
  760          // è¿”å›å‚æ•°     void
  761          // ä½¿ç”¨ç¤ºä¾‹     spi_init(SPI_1, 0, 1*1000*1000, A5, A7, A6, A4);
  762          // å¤‡æ³¨ä¿¡æ¯     
  763          //-------------------------------------------------------------------------------------------------------
             -------------
  764          void soft_spi_init (soft_spi_info_struct *soft_spi_obj, uint8 mode, uint32 delay, gpio_pin_enum sck_pin, 
             -gpio_pin_enum mosi_pin, uint32 miso_pin, uint32 cs_pin)
  765          {
  766   1          zf_assert(soft_spi_obj != NULL);
  767   1          zf_assert(sck_pin != mosi_pin);                                             // sck_pin  ä¸ mosi_pin 
             -æ€ä¹ˆèƒ½å¡«åŒä¸€ä¸ªå¼•è„šï¼Ÿ
  768   1          zf_assert(sck_pin != miso_pin);                                             // sck_pin  ä¸ miso_pin 
             -æ€ä¹ˆèƒ½å¡«åŒä¸€ä¸ªå¼•è„šï¼Ÿ
  769   1          zf_assert(sck_pin != cs_pin);                                               // sck_pin  ä¸ cs_pin   
             -æ€ä¹ˆèƒ½å¡«åŒä¸€ä¸ªå¼•è„šï¼Ÿ
  770   1          zf_assert(mosi_pin != miso_pin);                                            // mosi_pin ä¸ miso_pin 
             -æ€ä¹ˆèƒ½å¡«åŒä¸€ä¸ªå¼•è„šï¼Ÿ
  771   1          zf_assert(mosi_pin != cs_pin);                                              // mosi_pin ä¸ cs_pin   
             -æ€ä¹ˆèƒ½å¡«åŒä¸€ä¸ªå¼•è„šï¼Ÿ
C251 COMPILER V5.60.0,  zf_driver_soft_spi                                                 08/01/26  02:12:47  PAGE 14  

  772   1          zf_assert((miso_pin != cs_pin) || (cs_pin == SOFT_SPI_PIN_NULL));           // miso_pin ä¸ cs_pin   
             -æ€ä¹ˆèƒ½å¡«åŒä¸€ä¸ªå¼•è„šï¼Ÿ
  773   1      
  774   1          zf_assert(4 > mode);                                                        // å‚ç…§ zf_driver_spi.h
             - å†… spi_mode_enum æšä¸¾ä½“å®šä¹‰
  775   1      
  776   1          soft_spi_obj->config.mode = mode;
  777   1          soft_spi_obj->delay = delay;
  778   1      
  779   1          soft_spi_obj->sck_pin = sck_pin;
  780   1          soft_spi_obj->mosi_pin = mosi_pin;
  781   1          if(0 == mode || 1 == mode)
  782   1          {
  783   2              gpio_init(sck_pin, GPO, GPIO_LOW, GPO_PUSH_PULL);                       // IO åˆå§‹åŒ–
  784   2          }
  785   1          else
  786   1          {
  787   2              gpio_init(sck_pin, GPO, GPIO_HIGH, GPO_PUSH_PULL);                      // IO åˆå§‹åŒ–
  788   2          }
  789   1          gpio_init(mosi_pin, GPO, GPIO_HIGH, GPO_PUSH_PULL);                         // IO åˆå§‹åŒ–
  790   1      
  791   1          if(SOFT_SPI_PIN_NULL == miso_pin)
  792   1          {
  793   2              soft_spi_obj->config.use_miso = 0;
  794   2          }
  795   1          else
  796   1          {
  797   2              soft_spi_obj->config.use_miso = 1;
  798   2              soft_spi_obj->miso_pin = miso_pin;
  799   2              gpio_init(soft_spi_obj->miso_pin, GPI, GPIO_HIGH, GPI_PULL_UP);     // IO åˆå§‹åŒ–
  800   2          }
  801   1          if(SOFT_SPI_PIN_NULL == cs_pin)
  802   1          {
  803   2              soft_spi_obj->config.use_cs = 0;
  804   2          }
  805   1          else
  806   1          {
  807   2              soft_spi_obj->config.use_cs = 1;
  808   2              soft_spi_obj->cs_pin = cs_pin;
  809   2              gpio_init(soft_spi_obj->cs_pin, GPO, GPIO_HIGH, GPO_PUSH_PULL);         // IO åˆå§‹åŒ–
  810   2          }
  811   1      }


Module Information          Static   Overlayable
------------------------------------------------
  code size            =      3628     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------        140
  xdata-const size     =    ------     ------
  edata size           =    ------     ------
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =        47     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
