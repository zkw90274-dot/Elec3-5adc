C251 COMPILER V5.60.0,  key                                                                24/01/26  18:53:02  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE key
OBJECT MODULE PLACED IN .\out_file\key.obj
COMPILER INVOKED BY: E:\Tools\keil5\Keil_v5\C251\BIN\C251.EXE ..\code\key.c LARGE NOALIAS WARNINGLEVEL(3) OPTIMIZE(SIZE)
                    - BROWSE INCDIR(..\..\libraries\zf_common;..\..\libraries\zf_components;..\..\libraries\zf_device;..\..\libraries\zf_driv
                    -er;..\user;..\code) DEBUG PRINT(.\out_file\key.lst) TABS(2) OBJECT(.\out_file\key.obj) 

stmt  level    source

    1          #include "key.h"
    2          
    3          //-------------------------------------------------------------------------------------------------------
             -------------
    4          // 全局变量定义
    5          //-------------------------------------------------------------------------------------------------------
             -------------
    6          uint8 key_val, key_old, key_down, key_up;
    7          
    8          //-------------------------------------------------------------------------------------------------------
             -------------
    9          // 函数简介     按键初始化
   10          // 参数说明     void
   11          // 返回参数     void
   12          // 使用示例     key_init();
   13          // 备注信息     配置4个按键为上拉输入模式
   14          //-------------------------------------------------------------------------------------------------------
             -------------
   15          void key_init(void)
   16          {
   17   1          gpio_init(KEY1_PIN, GPI, 1, GPI_PULL_UP);
   18   1          gpio_init(KEY2_PIN, GPI, 1, GPI_PULL_UP);
   19   1          gpio_init(KEY3_PIN, GPI, 1, GPI_PULL_UP);
   20   1          gpio_init(KEY4_PIN, GPI, 1, GPI_PULL_UP);
   21   1      }
   22          
   23          //-------------------------------------------------------------------------------------------------------
             -------------
   24          // 函数简介     按键扫描（位运算消抖）
   25          // 参数说明     void
   26          // 返回参数     uint8           按键键值 1-4，无按键按下返回0
   27          // 使用示例     uint8 key = Key_Read();
   28          // 备注信息     使用位运算进行按键消抖，连续读取一致才确认状态
   29          //              按键按下时引脚为低电平(0)
   30          //-------------------------------------------------------------------------------------------------------
             -------------
   31          uint8 Key_Read(void)
   32          {
   33   1          uint8 key_temp = KEY_NULL;
   34   1      
   35   1          // 连续3次读取一致才确认（位运算消抖）
   36   1          if(gpio_get_level(KEY1_PIN) == 0 &&
   37   1             gpio_get_level(KEY1_PIN) == 0 &&
   38   1             gpio_get_level(KEY1_PIN) == 0)
   39   1              key_temp = KEY1;
   40   1      
   41   1          if(gpio_get_level(KEY2_PIN) == 0 &&
   42   1             gpio_get_level(KEY2_PIN) == 0 &&
   43   1             gpio_get_level(KEY2_PIN) == 0)
   44   1              key_temp = KEY2;
   45   1      
   46   1          if(gpio_get_level(KEY3_PIN) == 0 &&
   47   1             gpio_get_level(KEY3_PIN) == 0 &&
   48   1             gpio_get_level(KEY3_PIN) == 0)
   49   1              key_temp = KEY3;
   50   1      
   51   1          if(gpio_get_level(KEY4_PIN) == 0 &&
C251 COMPILER V5.60.0,  key                                                                24/01/26  18:53:02  PAGE 2   

   52   1             gpio_get_level(KEY4_PIN) == 0 &&
   53   1             gpio_get_level(KEY4_PIN) == 0)
   54   1              key_temp = KEY4;
   55   1      
   56   1          return key_temp;
   57   1      }
   58          
   59          //-------------------------------------------------------------------------------------------------------
             -------------
   60          // 函数简介     按键处理函数
   61          // 参数说明     void
   62          // 返回参数     void
   63          // 使用示例     Key_Disp();
   64          // 备注信息     检测按键按下和释放事件，更新按键状态
   65          //              key_down: 按键按下标志（只在按下那一帧为1）
   66          //              key_up:   按键释放标志（只在释放那一帧为1）
   67          //-------------------------------------------------------------------------------------------------------
             -------------
   68          void Key_Disp(void)
   69          {
   70   1          key_val = Key_Read();                          // 实时读取键码值
   71   1          key_down = key_val & (key_old ^ key_val);      // 捕捉按键下降沿（按下）
   72   1          key_up = ~key_val & (key_old ^ key_val);       // 捕捉按键上升沿（释放）
   73   1          key_old = key_val;                             // 辅助扫描变量
   74   1      
   75   1          // 按键事件处理（用户根据需求添加）
   76   1          // switch(key_down)
   77   1          // {
   78   1          //     case KEY1:
   79   1          //         // 按键1处理
   80   1          //         break;
   81   1          //
   82   1          //     case KEY2:
   83   1          //         // 按键2处理
   84   1          //         break;
   85   1          //
   86   1          //     case KEY3:
   87   1          //         // 按键3处理
   88   1          //         break;
   89   1          //
   90   1          //     case KEY4:
   91   1          //         // 按键4处理
   92   1          //         break;
   93   1          // }
   94   1      }


Module Information          Static   Overlayable
------------------------------------------------
  code size            =       231     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =         4     ------
  xdata-const size     =    ------     ------
  edata size           =    ------     ------
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =    ------     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
