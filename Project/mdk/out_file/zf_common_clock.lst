C251 COMPILER V5.60.0,  zf_common_clock                                                    08/01/26  02:12:46  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE zf_common_clock
OBJECT MODULE PLACED IN .\out_file\zf_common_clock.obj
COMPILER INVOKED BY: E:\Tools\keil5\Keil_v5\C251\BIN\C251.EXE ..\..\libraries\zf_common\zf_common_clock.c LARGE NOALIAS 
                    -WARNINGLEVEL(3) OPTIMIZE(SIZE) BROWSE INCDIR(..\..\libraries\zf_common;..\..\libraries\zf_components;..\..\libraries\zf_
                    -device;..\..\libraries\zf_driver;..\user;..\code) DEBUG PRINT(.\out_file\zf_common_clock.lst) TABS(2) OBJECT(.\out_file\
                    -zf_common_clock.obj) 

stmt  level    source

    1          /********************************************************************************************************
             -*************
    2          * STC32G Opensourec Library å³ï¼ˆSTC32G å¼€æºåº“ï¼‰æ˜¯ä¸€ä¸ªåŸºäºå®˜æ–¹ SDK æ¥å£çš„ç¬¬ä¸‰æ–¹å¼€æºåº
             -“
    3          * Copyright (c) 2022 SEEKFREE é€é£ç§‘æŠ€
    4          *
    5          * æœ¬æ–‡ä»¶æ˜¯STC å¼€æºåº“çš„ä¸€éƒ¨åˆ†
    6          *
    7          * STC32G å¼€æºåº“ æ˜¯å…è´¹è½¯ä»¶
    8          * æ‚¨å¯ä»¥æ ¹æ®è‡ªç”±è½¯ä»¶åŸºé‡‘ä¼šå‘å¸ƒçš„ GPLï¼ˆGNU General Public Licenseï¼Œå³ GNUé€šç”¨å…¬å…±è®¸
             -å¯è¯ï¼‰çš„æ¡æ¬¾
    9          * å³ GPL çš„ç¬¬3ç‰ˆï¼ˆå³ GPL3.0ï¼‰æˆ–ï¼ˆæ‚¨é€‰æ‹©çš„ï¼‰ä»»ä½•åæ¥çš„ç‰ˆæœ¬ï¼Œé‡æ–°å‘å¸ƒå’Œ/æˆ–ä¿®æ”
             -¹å®ƒ
   10          *
   11          * æœ¬å¼€æºåº“çš„å‘å¸ƒæ˜¯å¸Œæœ›å®ƒèƒ½å‘æŒ¥ä½œç”¨ï¼Œä½†å¹¶æœªå¯¹å…¶ä½œä»»ä½•çš„ä¿è¯
   12          * ç”šè‡³æ²¡æœ‰éšå«çš„é€‚é”€æ€§æˆ–é€‚åˆç‰¹å®šç”¨é€”çš„ä¿è¯
   13          * æ›´å¤šç»†èŠ‚è¯·å‚è§ GPL
   14          *
   15          * æ‚¨åº”è¯¥åœ¨æ”¶åˆ°æœ¬å¼€æºåº“çš„åŒæ—¶æ”¶åˆ°ä¸€ä»½ GPL çš„å‰¯æœ¬
   16          * å¦‚æœæ²¡æœ‰ï¼Œè¯·å‚é˜…<https://www.gnu.org/licenses/>
   17          *
   18          * é¢å¤–æ³¨æ˜ï¼š
   19          * æœ¬å¼€æºåº“ä½¿ç”¨ GPL3.0 å¼€æºè®¸å¯è¯åè®® ä»¥ä¸Šè®¸å¯ç”³æ˜ä¸ºè¯‘æ–‡ç‰ˆæœ¬
   20          * è®¸å¯ç”³æ˜è‹±æ–‡ç‰ˆåœ¨ libraries/doc æ–‡ä»¶å¤¹ä¸‹çš„ GPL3_permission_statement.txt æ–‡ä»¶ä¸­
   21          * è®¸å¯è¯å‰¯æœ¬åœ¨ libraries æ–‡ä»¶å¤¹ä¸‹ å³è¯¥æ–‡ä»¶å¤¹ä¸‹çš„ LICENSE æ–‡ä»¶
   22          * æ¬¢è¿å„ä½ä½¿ç”¨å¹¶ä¼ æ’­æœ¬ç¨‹åº ä½†ä¿®æ”¹å†…å®¹æ—¶å¿…é¡»ä¿ç•™é€é£ç§‘æŠ€çš„ç‰ˆæƒå£°æ˜ï¼ˆå³æœ¬
             -å£°æ˜ï¼‰
   23          *
   24          * æ–‡ä»¶åç§°          
   25          * å…¬å¸åç§°          æˆéƒ½é€é£ç§‘æŠ€æœ‰é™å…¬å¸
   26          * ç‰ˆæœ¬ä¿¡æ¯          æŸ¥çœ‹ libraries/doc æ–‡ä»¶å¤¹å†… version æ–‡ä»¶ ç‰ˆæœ¬è¯´æ˜
   27          * å¼€å‘ç¯å¢ƒ          MDK FOR C251
   28          * é€‚ç”¨å¹³å°          STC32G
   29          * åº—é“ºé“¾æ¥          https://seekfree.taobao.com/
   30          *
   31          * ä¿®æ”¹è®°å½•
   32          * æ—¥æœŸ              ä½œè€…           å¤‡æ³¨
   33          * 2024-08-01        å¤§W            first version
   34          *********************************************************************************************************
             -***********/
   35          
   36          #include "zf_common_typedef.h"
   37          #include "zf_common_clock.h"
   38          #include "zf_common_debug.h"
   39          #include "zf_common_interrupt.h"
   40          
   41          #include "zf_driver_delay.h"
   42          
   43          //å†…æ ¸é¢‘ç‡
   44          int32 system_clock = SYSTEM_CLOCK_30M;
   45          
   46          
   47          
   48          //-------------------------------------------------------------------------------------------------------
             -------------
   49          //  @brief      STC32Gè®¾ç½®ç³»ç»Ÿé¢‘ç‡
C251 COMPILER V5.60.0,  zf_common_clock                                                    08/01/26  02:12:46  PAGE 2   

   50          //  @param      NULL            ç©ºå€¼
   51          //  @return     void          ç³»ç»Ÿé¢‘ç‡
   52          //  Sample usage:               
   53          //-------------------------------------------------------------------------------------------------------
             -------------
   54          uint32 set_sys_clk(uint32 sys_clk)
   55          {
   56   1        
   57   1        P_SW2 |= 0x80;
   58   1          
   59   1        switch(sys_clk) 
   60   1        {
   61   2          case SYSTEM_CLOCK_22_1184M:
   62   2            // é€‰æ‹© 22.1184MHz
   63   2            CLKDIV = 0x04;
   64   2            IRTRIM = T22M_ADDR;
   65   2            VRTRIM = VRT27M_ADDR;
   66   2            IRCBAND = 0x02;
   67   2            CLKDIV = 0x00;
   68   2          break;
   69   2            
   70   2          case SYSTEM_CLOCK_24M:
   71   2            // é€‰æ‹© 24MHz
   72   2            CLKDIV = 0x04;
   73   2            IRTRIM = T24M_ADDR;
   74   2            VRTRIM = VRT27M_ADDR;
   75   2            IRCBAND = 0x02;
   76   2            CLKDIV = 0x00;
   77   2          break;
   78   2            
   79   2          case SYSTEM_CLOCK_27M:
   80   2            // é€‰æ‹© 27MHz
   81   2            CLKDIV = 0x04;
   82   2            IRTRIM = T27M_ADDR;
   83   2            VRTRIM = VRT27M_ADDR;
   84   2            IRCBAND = 0x02;
   85   2            CLKDIV = 0x00;
   86   2          break;
   87   2            
   88   2          case SYSTEM_CLOCK_30M:
   89   2            // é€‰æ‹© 30MHz
   90   2            CLKDIV = 0x04;
   91   2            IRTRIM = T30M_ADDR;
   92   2            VRTRIM = VRT27M_ADDR;
   93   2            IRCBAND = 0x02;
   94   2            CLKDIV = 0x00;
   95   2          break;
   96   2            
   97   2          case SYSTEM_CLOCK_33_1776M:
   98   2            // é€‰æ‹© 33.1776MHz
   99   2            CLKDIV = 0x04;
  100   2            IRTRIM = T33M_ADDR;
  101   2            VRTRIM = VRT27M_ADDR;
  102   2            IRCBAND = 0x02;
  103   2            CLKDIV = 0x00;
  104   2          break;
  105   2            
  106   2          case SYSTEM_CLOCK_35M:
  107   2            // é€‰æ‹© 35MHz
  108   2            CLKDIV = 0x04;
  109   2            IRTRIM = T35M_ADDR;
  110   2            VRTRIM = VRT44M_ADDR;
  111   2            IRCBAND = 0x03;
  112   2            CLKDIV = 0x00;
  113   2          break;
  114   2            
C251 COMPILER V5.60.0,  zf_common_clock                                                    08/01/26  02:12:46  PAGE 3   

  115   2          default:
  116   2            sys_clk = SYSTEM_CLOCK_30M;
  117   2            // é€‰æ‹© 30MHz
  118   2            CLKDIV = 0x04;
  119   2            IRTRIM = T30M_ADDR;
  120   2            VRTRIM = VRT27M_ADDR;
  121   2            IRCBAND = 0x02;
  122   2            CLKDIV = 0x00;
  123   2          break;
  124   2        }
  125   1      
  126   1        return sys_clk;
  127   1      }
  128          
  129          
  130          
  131          
  132          void clock_init (uint32 clock)                                              // æ ¸å¿ƒæ—¶é’Ÿåˆå§‹åŒ–
  133          {
  134   1        EAXFR = 1;        // ä½¿èƒ½è®¿é—®XFR
  135   1        P_SW2 = 0x80;           // å¼€å¯ç‰¹æ®Šåœ°å€è®¿é—®
  136   1          CKCON = 0x00;           // è®¾ç½®å¤–éƒ¨æ•°æ®æ€»çº¿ä¸ºæœ€å¿«
  137   1          WTST = 0;               // è®¾ç½®ç¨‹åºä»£ç ç­‰å¾…å‚æ•°ï¼Œèµ‹å€¼ä¸º0å¯å°†CPUæ‰§è¡Œç¨‹åºçš„é€Ÿåº¦è
             -®¾ç½®ä¸ºæœ€å¿«
  138   1      
  139   1      #if (1 == EXTERNAL_CRYSTA_ENABLE)
                 XOSCCR = 0xc0;      //å¯åŠ¨å¤–éƒ¨æ™¶æŒ¯
                 while (!(XOSCCR & 1));  //ç­‰å¾…æ—¶é’Ÿç¨³å®š
                 CLKDIV = 0x00;      //æ—¶é’Ÿä¸åˆ†é¢‘
                 CLKSEL = 0x01;      //é€‰æ‹©å¤–éƒ¨æ™¶æŒ¯
               #else
  145   1        //è‡ªåŠ¨è®¾ç½®ç³»ç»Ÿé¢‘ç‡
  146   1        #if (0 == FOSC)
  147   1          system_clock = set_sys_clk(clock);
  148   1        #else
                   system_clock = FOSC;
                 #endif
  151   1      #endif
  152   1      
  153   1        system_delay_init();    // å»¶æ—¶å‡½æ•°åˆå§‹åŒ–
  154   1      
  155   1       
  156   1        P0M0 = 0x00;
  157   1        P0M1 = 0x00;
  158   1        P1M0 = 0x00;
  159   1        P1M1 = 0x00;
  160   1        P2M0 = 0x00;
  161   1        P2M1 = 0x00;
  162   1        P3M0 = 0x00;
  163   1        P3M1 = 0x00;
  164   1        P4M0 = 0x00;
  165   1        P4M1 = 0x00;
  166   1        P5M0 = 0x00;
  167   1        P5M1 = 0x00;
  168   1        P6M0 = 0x00;
  169   1        P6M1 = 0x00;
  170   1        P7M0 = 0x00;
  171   1        P7M1 = 0x00;
  172   1        
  173   1        ADCCFG = 0;
  174   1        AUXR = 0;
  175   1        SCON = 0;
  176   1        S2CON = 0;
  177   1        S3CON = 0;
  178   1        S4CON = 0;
  179   1        P_SW1 = 0;
C251 COMPILER V5.60.0,  zf_common_clock                                                    08/01/26  02:12:46  PAGE 4   

  180   1        IE2 = 0;
  181   1        TMOD = 0;
  182   1        
  183   1        interrupt_global_enable();
  184   1      }
  185          
  186          


Module Information          Static   Overlayable
------------------------------------------------
  code size            =       363     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =         4     ------
  xdata-const size     =    ------     ------
  edata size           =    ------     ------
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =         9     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
