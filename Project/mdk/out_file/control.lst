C251 COMPILER V5.60.0,  control                                                            25/01/26  01:31:18  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE control
OBJECT MODULE PLACED IN .\out_file\control.obj
COMPILER INVOKED BY: E:\Tools\keil5\Keil_v5\C251\BIN\C251.EXE ..\code\control.c LARGE NOALIAS WARNINGLEVEL(3) OPTIMIZE(S
                    -IZE) BROWSE INCDIR(..\..\libraries\zf_common;..\..\libraries\zf_components;..\..\libraries\zf_device;..\..\libraries\zf_
                    -driver;..\user;..\code) DEBUG PRINT(.\out_file\control.lst) TABS(2) OBJECT(.\out_file\control.obj) 

stmt  level    source

    1          #include "control.h"
    2          
    3          // 全局变量定义
    4          SDSD_param_t SDSD;
    5          int32 sub;    // 差值
    6          int32 sum;    // 和值
    7          float res;    // 结果值
    8          
    9          //-------------------------------------------------------------------------------------------------------
             -------------
   10          // 函数简介     差比和差参数初始化
   11          // 参数说明     SDSD            差比和差结构体指针
   12          // 参数说明     A               水平系数(系数A)
   13          // 参数说明     B               垂直系数(系数B)
   14          // 参数说明     C               垂直系数(系数C)
   15          // 返回参数     void
   16          // 使用示例     SDSD_init(&SDSD, 1.0, 1.0, 1.0);
   17          //-------------------------------------------------------------------------------------------------------
             -------------
   18          void SDSD_init(SDSD_param_t *SDSD, float A, float B, float C)
   19          {
   20   1          SDSD->parallel_err_A = A;
   21   1          SDSD->vertical_err_B = B;
   22   1          SDSD->vertival_err_C = C;
   23   1      }
   24          
   25          //-------------------------------------------------------------------------------------------------------
             -------------
   26          // 函数简介     差比和差计算
   27          // 参数说明     SDSD            差比和差结构体指针
   28          // 返回参数     float           差比和差计算结果
   29          // 使用示例     float result = SDSD_calculate(&SDSD);
   30          // 备注信息     计算差比和差值用于循迹控制
   31          //              适配5路传感器布局: [0][1][2][3][4]
   32          //              使用全部5个传感器计算加权偏差
   33          //              负数=偏左, 正数=偏右, 0=居中
   34          //              计算公式: result = 100*(右-左) / (右+左+|中|+1)
   35          //-------------------------------------------------------------------------------------------------------
             -------------
   36          float SDSD_calculate(SDSD_param_t *SDSD)
   37          {
   38   1          // 5路传感器布局: [0]  [1]  [2]  [3]  [4]
   39   1          //                最左  左   中   右  最右
   40   1          //                权重: 1   2   3   2   1
   41   1      
   42   1          // 差值计算: 右侧传感器和 - 左侧传感器和
   43   1          // 系数A: 主要传感器(1,3)权重
   44   1          // 系数B: 次要传感器(0,4)权重
   45   1          sub = (SDSD->parallel_err_A * (adc_normalized_list[3] + adc_normalized_list[4] -
   46   1                                         adc_normalized_list[1] - adc_normalized_list[0]) +
   47   1                 SDSD->vertical_err_B * (adc_normalized_list[3] - adc_normalized_list[1])) * 100;
   48   1      
   49   1          // 和值计算: 所有传感器激活程度 + 1（防止除零）
   50   1          // 系数C: 中心传感器(2)的归一化权重
   51   1          sum = SDSD->parallel_err_A * (adc_normalized_list[0] + adc_normalized_list[1] +
   52   1                                        adc_normalized_list[3] + adc_normalized_list[4]) +
   53   1                SDSD->vertival_err_C * adc_normalized_list[2] + 1;
C251 COMPILER V5.60.0,  control                                                            25/01/26  01:31:18  PAGE 2   

   54   1      
   55   1          res = sub / sum;
   56   1      
   57   1          // 限幅
   58   1          if(res > SDSD_MAX)
   59   1              res = SDSD_MAX;
   60   1          else if(res < SDSD_MIN)
   61   1              res = SDSD_MIN;
   62   1      
   63   1          return res;
   64   1      }


Module Information          Static   Overlayable
------------------------------------------------
  code size            =       308     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =        24          8
  xdata-const size     =    ------     ------
  edata size           =    ------     ------
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =    ------     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
