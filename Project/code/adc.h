#ifndef _ADC_H_
#define _ADC_H_

//-------------------------------------------------------------------------------------------------------------------
// 头文件包含
//-------------------------------------------------------------------------------------------------------------------
#include "zf_common_headfile.h"

//-------------------------------------------------------------------------------------------------------------------
// ADC通道宏定义
//-------------------------------------------------------------------------------------------------------------------
#define ADC_R5      ADC_CH14_P06          // 右侧传感器5
#define ADC_R4      ADC_CH13_P05          // 右侧传感器4
#define ADC_M3      ADC_CH1_P11           // 中间传感器3
#define ADC_L2      ADC_CH0_P10           // 左侧传感器2
#define ADC_L1      ADC_CH6_P16           // 左侧传感器1

//-------------------------------------------------------------------------------------------------------------------
// 宏定义
//-------------------------------------------------------------------------------------------------------------------
#define CHANNEL_NUMBER          (5)       // ADC通道数量
#define ADC_Sample_Num          (7)       // ADC采样深度

//-------------------------------------------------------------------------------------------------------------------
// 全局变量声明
//-------------------------------------------------------------------------------------------------------------------
extern uint16 adc_val_list[CHANNEL_NUMBER];                  // ADC原始值数组
extern adc_channel_enum channel_list[CHANNEL_NUMBER];        // ADC通道枚举数组
extern uint8 channel_index;                                  // 当前通道索引
extern uint16 max_min_adc[2*CHANNEL_NUMBER];                 // ADC最大最小值校准数组

//-------------------------------------------------------------------------------------------------------------------
// 函数声明 - 基础功能
//-------------------------------------------------------------------------------------------------------------------
void Adc_All_Init(void);                                     // ADC全部通道初始化
void Adc_Test(void);                                        // ADC测试函数
void Adc_Getval(void);                                      // 获取ADC值 - 简单平均滤波
void Adc_Getval_Mid(void);                                  // 获取ADC值 - 中值滤波
void Adc_Getval_Avg(void);                                  // 获取ADC值 - 去极值平均滤波
void Adc_Getval_Combined(void);                             // 获取ADC值 - 组合滤波(推荐)
uint16 limit(uint16 adc_val, uint8 index);                   // ADC值限幅函数

//-------------------------------------------------------------------------------------------------------------------
// 函数声明 - 多重滤波策略
//-------------------------------------------------------------------------------------------------------------------

//-------------------------------------------------------------------------------------------------------------------
// 函数简介     中值滤波 (三次采样取中值)
// 参数说明     ch              ADC通道枚举
// 返回参数     uint16          中值滤波后的ADC值
// 使用示例     uint16 val = adc_mid_sample(ADC_L1);
// 备注信息     连续采样3次，取中间值，有效去除脉冲干扰
//-------------------------------------------------------------------------------------------------------------------
uint16 adc_mid_sample(adc_channel_enum ch);

//-------------------------------------------------------------------------------------------------------------------
// 函数简介     去极值平均滤波 (采样11次，去掉最大最小后取平均)
// 参数说明     ch              ADC通道枚举
// 返回参数     uint16          滤波后的ADC值
// 使用示例     uint16 val = adc_sample(ADC_L1);
// 备注信息     采样11次，去除1个最大值和1个最小值，剩余9个取平均
//              优点: 去除极值干扰，平滑信号
//-------------------------------------------------------------------------------------------------------------------
uint16 adc_sample(adc_channel_enum ch);

//-------------------------------------------------------------------------------------------------------------------
// 函数简介     中值+去极值组合滤波 (中值滤波后再去极值平均)
// 参数说明     ch              ADC通道枚举
// 返回参数     uint16          滤波后的ADC值
// 使用示例     uint16 val = adc_sample_b(ADC_L1);
// 备注信息     先进行三次中值滤波，连续8次中值后再去极值平均
//              优点: 双重滤波，更强的抗干扰能力
//-------------------------------------------------------------------------------------------------------------------
uint16 adc_sample_b(adc_channel_enum ch);

//-------------------------------------------------------------------------------------------------------------------
// 函数简介     排序取中值滤波 (7次采样排序后取中值)
// 参数说明     ch              ADC通道枚举
// 返回参数     uint16          中值
// 使用示例     uint16 val = adc_sample_a(ADC_L1);
// 备注信息     采样7次，排序后取第4个值(中值)
//-------------------------------------------------------------------------------------------------------------------
uint16 adc_sample_a(adc_channel_enum ch);

//-------------------------------------------------------------------------------------------------------------------
// 函数简介     7元素冒泡排序
// 参数说明     arr             7元素数组指针
// 返回参数     uint16          排序后数组的首地址(中值在arr[0])
// 使用示例     arr[0] = sort_seven(arr);
// 备注信息     对7个元素进行冒泡排序，中值位于arr[0]
//-------------------------------------------------------------------------------------------------------------------
uint16 sort_seven(uint16 arr[]);

#endif
