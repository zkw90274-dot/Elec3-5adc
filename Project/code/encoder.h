#ifndef _ENCODER_H_
#define _ENCODER_H_

//-------------------------------------------------------------------------------------------------------------------
// 头文件包含
//-------------------------------------------------------------------------------------------------------------------
#include "zf_common_headfile.h"

//-------------------------------------------------------------------------------------------------------------------
// 宏定义 - 编码器硬件引脚
//-------------------------------------------------------------------------------------------------------------------
// 右编码器
#define ENCODER_DIR_R                  (TIM0_ENCOEDER)                         // 右编码器对应的定时器编码器接口
#define ENCODER_DIR_DIR_R              (IO_P35)            				 	// DIR 对应引脚
#define ENCODER_DIR_PULSE_R            (TIM0_ENCOEDER_P34)            			// PULSE 对应引脚

// 左编码器
#define ENCODER_DIR_L                  (TIM3_ENCOEDER)                         // 左编码器对应的定时器编码器接口
#define ENCODER_DIR_DIR_L              (IO_P53)             					// DIR 对应引脚
#define ENCODER_DIR_PULSE_L            (TIM3_ENCOEDER_P04)            			// PULSE 对应引脚

//-------------------------------------------------------------------------------------------------------------------
// 全局变量声明
//-------------------------------------------------------------------------------------------------------------------
extern int16 encoder_data_dir_L;                                      // 左编码器计数值
extern int16 encoder_data_dir_R;                                      // 右编码器计数值

//-------------------------------------------------------------------------------------------------------------------
// 函数声明
//-------------------------------------------------------------------------------------------------------------------
void Encoder_Init(void);                                              // 编码器初始化

//-------------------------------------------------------------------------------------------------------------------
// 函数简介     一阶IIR低通滤波器
// 参数说明     new_val         新采样值
// 参数说明     last_val        上次滤波值
// 参数说明     alpha           滤波系数 (0.0-1.0), 越小滤波越强
// 返回参数     float           滤波后的值
// 使用示例     filtered = iir_lowpass(new_value, last_value, 0.2f);
// 备注信息     一阶IIR低通滤波器公式: y[n] = alpha * x[n] + (1-alpha) * y[n-1]
//              alpha = 1.0  -> 无滤波 (直接输出)
//              alpha = 0.5  -> 中等滤波
//              alpha = 0.1  -> 强滤波
//              推荐值: 0.1-0.3
//-------------------------------------------------------------------------------------------------------------------
float iir_lowpass(float new_val, float last_val, float alpha);

//-------------------------------------------------------------------------------------------------------------------
// 函数简介     获取滤波后的编码器值 (推荐使用)
// 参数说明     void
// 返回参数     void
// 使用示例     Encoder_Get_Filtered();
// 备注信息     获取编码器原始值并经过一阶IIR低通滤波
//              滤波系数 alpha = 0.2 (可在函数中调整)
//              结果保存在 encoder_data_dir_L 和 encoder_data_dir_R 中
//              在中断中调用，自动完成采集、滤波、清零
//-------------------------------------------------------------------------------------------------------------------
void Encoder_Get_Filtered(void);

#endif
