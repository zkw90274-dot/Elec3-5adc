# STC32Gæ™ºèƒ½è½¦é¡¹ç›® - å®Œæ•´æµ‹è¯•æŒ‡å—

> **é¡¹ç›®æ¦‚è¿°ï¼š** åŸºäºSTC32Gå¾®æ§åˆ¶å™¨çš„æ™ºèƒ½å¾ªè¿¹å°è½¦
> **ç¡¬ä»¶å¹³å°ï¼š** STC32G + IMU660RB + 5è·¯ADCä¼ æ„Ÿå™¨ + åŒç¼–ç å™¨ç”µæœº
> **æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0
> **æ›´æ–°æ—¥æœŸï¼š** 2026-01-21

---

## ğŸ“‘ ç›®å½•

1. [ä»£ç æ¶æ„è¯´æ˜](#ä»£ç æ¶æ„è¯´æ˜)
2. [æ•°æ®æµå‘å›¾](#æ•°æ®æµå‘å›¾)
3. [æ ¸å¿ƒæ¨¡å—è¯¦è§£](#æ ¸å¿ƒæ¨¡å—è¯¦è§£)
4. [å®Œæ•´æµ‹è¯•æ–¹æ¡ˆ](#å®Œæ•´æµ‹è¯•æ–¹æ¡ˆ)
5. [å‚æ•°è°ƒä¼˜æŒ‡å—](#å‚æ•°è°ƒä¼˜æŒ‡å—)
6. [å¸¸è§é—®é¢˜æ’æŸ¥](#å¸¸è§é—®é¢˜æ’æŸ¥)

---

## ä»£ç æ¶æ„è¯´æ˜

### æ–‡ä»¶ç»“æ„

```
Project/code/
â”œâ”€â”€ ç¡¬ä»¶é©±åŠ¨å±‚ (é©±åŠ¨ç¨‹åº)
â”‚   â”œâ”€â”€ motor.c/h          # ç”µæœºé©±åŠ¨ï¼ˆPWM + æ–¹å‘æ§åˆ¶ï¼‰
â”‚   â”œâ”€â”€ encoder.c/h        # ç¼–ç å™¨ï¼ˆé€Ÿåº¦åé¦ˆ + IIRæ»¤æ³¢ï¼‰
â”‚   â”œâ”€â”€ adc.c/h            # ADCé‡‡é›†ï¼ˆ5è·¯ä¼ æ„Ÿå™¨ + å¤šé‡æ»¤æ³¢ï¼‰
â”‚   â”œâ”€â”€ IMU.c/h            # IMU660RBï¼ˆå§¿æ€ä¼ æ„Ÿå™¨ï¼‰
â”‚   â”œâ”€â”€ lcd.c/h            # LCDæ˜¾ç¤º
â”‚   â”œâ”€â”€ key.c/h            # æŒ‰é”®è¾“å…¥
â”‚   â””â”€â”€ uart.c/h           # ä¸²å£é€šä¿¡
â”‚
â”œâ”€â”€ ç®—æ³•å±‚ (æ§åˆ¶ç®—æ³•)
â”‚   â”œâ”€â”€ pid.c/h            # PID/PDæ§åˆ¶å™¨ï¼ˆé€Ÿåº¦ç¯ + æ–¹å‘ç¯ + è§’é€Ÿåº¦ç¯ï¼‰
â”‚   â”œâ”€â”€ control.c/h        # SDSDç®—æ³•ï¼ˆå·®æ¯”å’Œå·®å¾ªè¿¹ï¼‰
â”‚   â””â”€â”€ normalization.c/h  # å½’ä¸€åŒ–ï¼ˆADCåŸå§‹å€¼ â†’ 0-50æ ‡å‡†å€¼ï¼‰
â”‚
â””â”€â”€ ä»»åŠ¡å±‚ (ä¸»æ§åˆ¶é€»è¾‘)
    â””â”€â”€ task.c/h           # æ§åˆ¶ä»»åŠ¡ç®¡ç†ï¼ˆæ¨¡å¼åˆ‡æ¢ + ä¸»æ§åˆ¶é€»è¾‘ï¼‰
```

### æ§åˆ¶æ¨¡å¼è¯´æ˜

æœ¬é¡¹ç›®æ”¯æŒä¸‰ç§æ§åˆ¶æ¨¡å¼ï¼Œé€šè¿‡ `task.h` ä¸­çš„å®å®šä¹‰åˆ‡æ¢ï¼š

| æ¨¡å¼ç¼–å· | æ¨¡å¼åç§° | æ§åˆ¶ç­–ç•¥ | é€‚ç”¨åœºæ™¯ |
|----------|----------|----------|----------|
| **0** | çº¯PIDé€Ÿåº¦ç¯ | ä»…é€Ÿåº¦é—­ç¯ï¼Œæ— å¾ªè¿¹ | ç”µæœºæµ‹è¯•ã€é€Ÿåº¦æ ¡å‡† |
| **1** | SDSDå¾ªè¿¹ | å·®æ¯”å’Œå·®ç®—æ³• + PID | åŸºç¡€å¾ªè¿¹ã€ç®€å•èµ›é“ |
| **2** | PDæ–¹å‘ç¯+è§’é€Ÿåº¦ç¯ | åŒç¯PDæ§åˆ¶ + IMU | å¤æ‚èµ›é“ã€é«˜ç²¾åº¦å¾ªè¿¹ |

**æ¨¡å¼åˆ‡æ¢æ–¹æ³•ï¼š**

ä¿®æ”¹ `code/task.h` ç¬¬30è¡Œï¼š
```c
// æ¨¡å¼0: æµ‹è¯•ç”µæœº
#define CONTROL_MODE_CURRENT  CONTROL_MODE_PID_ONLY

// æ¨¡å¼1: SDSDå¾ªè¿¹
// #define CONTROL_MODE_CURRENT  CONTROL_MODE_SDSD

// æ¨¡å¼2: PDæ–¹å‘ç¯+è§’é€Ÿåº¦ç¯
// #define CONTROL_MODE_CURRENT  CONTROL_MODE_PD_DIRECTION
```

---

## æ•°æ®æµå‘å›¾

### å®Œæ•´æ§åˆ¶æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ã€ä¼ æ„Ÿå™¨é‡‡é›†å±‚ã€‘ - å®šæ—¶ä¸­æ–­è§¦å‘                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ 5è·¯ADCä¼ æ„Ÿå™¨      â†’ Adc_Getval_Fast()  â†’ adc_val_list[5] â”‚
â”‚  â€¢ ç¼–ç å™¨(L/R)       â†’ Encoder_Get_Filtered() â†’ encoder_*  â”‚
â”‚  â€¢ IMU660RB (50ms)   â†’ imu_update_task()   â†’ imu.gyro_z   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ã€æ•°æ®é¢„å¤„ç†å±‚ã€‘                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ADCåŸå§‹å€¼ â†’ Normalization() â†’ adc_normalized_list[5]       â”‚
â”‚              å½’ä¸€åŒ–èŒƒå›´: 0-50                                â”‚
â”‚              â€¢ 0 = æœ€ç™½ï¼ˆèµ›é“çº¿å¤–ï¼‰                          â”‚
â”‚              â€¢ 25 = ä¸­é—´ï¼ˆèµ›é“è¾¹ç•Œï¼‰                         â”‚
â”‚              â€¢ 50 = æœ€é»‘ï¼ˆèµ›é“ä¸­å¿ƒçº¿ï¼‰                       â”‚
â”‚                                                             â”‚
â”‚  ç¼–ç å™¨åŸå§‹å€¼ â†’ IIRä½é€šæ»¤æ³¢(Î±=0.2) â†’ å¹³æ»‘é€Ÿåº¦å€¼             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ã€æ§åˆ¶ç®—æ³•å±‚ã€‘ - motor_control_task() (10mså‘¨æœŸ)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. ä¼ æ„Ÿå™¨æœ‰æ•ˆæ€§æ£€æŸ¥ (sensor_check_valid)                   â”‚
â”‚     â†’ å…¨é»‘æ£€æµ‹: ä¼ æ„Ÿå™¨1,2,3 > 48 (è„±ç¦»èµ›é“)                 â”‚
â”‚     â†’ å…¨ç™½æ£€æµ‹: ä¼ æ„Ÿå™¨1,2,3 < 2 (èµ·é£/æ•…éšœ)                 â”‚
â”‚                                                             â”‚
â”‚  2. æ ¹æ®æ¨¡å¼é€‰æ‹©æ§åˆ¶ç®—æ³•                                     â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚     â”‚ æ¨¡å¼0: pid_only_control()               â”‚             â”‚
â”‚     â”‚   â†’ è¿”å› 0 (æ— ä¿®æ­£ï¼Œä»…é€Ÿåº¦ç¯)            â”‚             â”‚
â”‚     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚
â”‚     â”‚ æ¨¡å¼1: sdsd_control_with_sensor_check() â”‚             â”‚
â”‚     â”‚   â†’ SDSD_calculate() (å·®æ¯”å’Œå·®)         â”‚             â”‚
â”‚     â”‚   â†’ pid_calc_position() (PIDæ§åˆ¶)       â”‚             â”‚
â”‚     â”‚   â†’ å¼‚å¸¸æ—¶ä¿æŒä¸Šæ¬¡è¾“å‡º                   â”‚             â”‚
â”‚     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚
â”‚     â”‚ æ¨¡å¼2: pd_control_with_sensor_check()   â”‚             â”‚
â”‚     â”‚   â†’ position_error_calc() (ä½ç½®è¯¯å·®)    â”‚             â”‚
â”‚     â”‚   â†’ pd_direction_gyro_loop() (åŒç¯PD)   â”‚             â”‚
â”‚     â”‚   â†’ å¼‚å¸¸æ—¶ä½¿ç”¨IMUè§’é€Ÿåº¦åé¦ˆ              â”‚             â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                             â”‚
â”‚  3. ç”µæœºé€Ÿåº¦ç¯PIDæ§åˆ¶                                       â”‚
â”‚     â†’ motor_pid_control(encoder_L + correction,             â”‚
â”‚                             encoder_R - correction)         â”‚
â”‚     â†’ å¢é‡å¼PIDè®¡ç®— â†’ PWMè¾“å‡º                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ ¸å¿ƒæ¨¡å—è¯¦è§£

### 1ï¸âƒ£ motor_control_task() - ä¸»æ§åˆ¶ä»»åŠ¡

**æ–‡ä»¶ä½ç½®ï¼š** `code/task.c:186-223`

**è°ƒç”¨å‘¨æœŸï¼š** 10mså®šæ—¶å™¨ä¸­æ–­

**åŠŸèƒ½è¯´æ˜ï¼š**
```c
void motor_control_task(void)
{
    // æ­¥éª¤1: è·å–æ»¤æ³¢åçš„ç¼–ç å™¨å€¼
    Encoder_Get_Filtered();

    // æ­¥éª¤2: æ ¹æ®æ¨¡å¼é€‰æ‹©æ§åˆ¶ç®—æ³•
    mode = get_control_mode();
    switch(mode) {
        case 0: correction = pid_only_control();      // è¿”å›0
        case 1: correction = sdsd_control_with_sensor_check();
        case 2: correction = pd_control_with_sensor_check();
    }

    // æ­¥éª¤3: ç”µæœºé€Ÿåº¦ç¯PIDæ§åˆ¶
    motor_pid_control(encoder_data_dir_L + correction,
                      encoder_data_dir_R - correction);
}
```

**å…³é”®ç‚¹ï¼š**
- å·¦è½®å åŠ ä¿®æ­£å€¼ï¼š`encoder_L + correction`
- å³è½®å‡å»ä¿®æ­£å€¼ï¼š`encoder_R - correction`
- correctionä¸ºæ­£ â†’ å³è½¬ï¼ˆå·¦è½®åŠ é€Ÿï¼Œå³è½®å‡é€Ÿï¼‰
- correctionä¸ºè´Ÿ â†’ å·¦è½¬ï¼ˆå·¦è½®å‡é€Ÿï¼Œå³è½®åŠ é€Ÿï¼‰

---

### 2ï¸âƒ£ SDSDç®—æ³• - å·®æ¯”å’Œå·®å¾ªè¿¹

**æ–‡ä»¶ä½ç½®ï¼š** `code/control.c:36-64`

**ä¼ æ„Ÿå™¨å¸ƒå±€ï¼š**
```
[0]   [1]   [2]   [3]   [4]
æœ€å·¦   å·¦   ä¸­    å³   æœ€å³
```

**è®¡ç®—å…¬å¼ï¼š**
```c
// å·®å€¼: å³ä¾§ä¼ æ„Ÿå™¨å’Œ - å·¦ä¾§ä¼ æ„Ÿå™¨å’Œ
sub = (A*(ä¼ æ„Ÿå™¨3+ä¼ æ„Ÿå™¨4-ä¼ æ„Ÿå™¨1-ä¼ æ„Ÿå™¨0) + B*(ä¼ æ„Ÿå™¨3-ä¼ æ„Ÿå™¨1)) * 100;

// å’Œå€¼: å½’ä¸€åŒ–å› å­
sum = A*(ä¼ æ„Ÿå™¨0+ä¼ æ„Ÿå™¨1+ä¼ æ„Ÿå™¨3+ä¼ æ„Ÿå™¨4) + C*ä¼ æ„Ÿå™¨2 + 1;

// ç»“æœ
result = sub / sum;
```

**è¾“å‡ºå«ä¹‰ï¼š**
| SDSDè¾“å‡ºå€¼ | å«ä¹‰ | ä¿®æ­£åŠ¨ä½œ |
|------------|------|----------|
| `result â‰ˆ 0` | å±…ä¸­ï¼ˆèµ›é“ä¸­å¿ƒï¼‰ | ä¿æŒç›´è¡Œ |
| `result < 0` | åå·¦ | å³è½¬ä¿®æ­£ |
| `result > 0` | åå³ | å·¦è½¬ä¿®æ­£ |

**å‚æ•°è¯´æ˜ï¼š**
- **A (parallel_err_A)ï¼š** å¤–å±‚ä¼ æ„Ÿå™¨(0,4)æƒé‡ï¼Œæ¨è0.5-1.5
- **B (vertical_err_B)ï¼š** å†…å±‚ä¼ æ„Ÿå™¨(1,3)æƒé‡ï¼Œæ¨è0.5-1.5
- **C (vertival_err_C)ï¼š** ä¸­å¿ƒä¼ æ„Ÿå™¨(2)æƒé‡ï¼Œæ¨è0.5-1.5

---

### 3ï¸âƒ£ PDæ–¹å‘ç¯+è§’é€Ÿåº¦ç¯ - åŒç¯æ§åˆ¶

**æ–‡ä»¶ä½ç½®ï¼š** `code/pid.c:351-394`

**æ§åˆ¶ç»“æ„ï¼š**
```
ä½ç½®è¯¯å·® â†’ PDæ–¹å‘ç¯ â†’ æœŸæœ›è§’é€Ÿåº¦ â†’ PDè§’é€Ÿåº¦ç¯ â†’ ç”µæœºä¿®æ­£å€¼
   â†‘                                                â†“
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ IMUè§’é€Ÿåº¦åé¦ˆ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä»£ç å®ç°ï¼š**
```c
float pd_direction_gyro_loop(float err_position)
{
    // ç¬¬ä¸€çº§ï¼šPDæ–¹å‘ç¯ï¼ˆä½ç½®è¯¯å·® â†’ æœŸæœ›è§’é€Ÿåº¦ï¼‰
    expect_gyro = pd_direction.kp * err_position +
                  pd_direction.kd * (err_position - last_err_position);
    expect_gyro = constrain(expect_gyro, -100, 100);

    // ç¬¬äºŒçº§ï¼šPDè§’é€Ÿåº¦ç¯ï¼ˆè§’é€Ÿåº¦è¯¯å·® â†’ ç”µæœºä¿®æ­£ï¼‰
    err_gyro = expect_gyro - imu.gyro_z;
    correction = pd_direction.kp_gyro * err_gyro +
                 pd_direction.kd_gyro * (err_gyro - last_err_gyro);
    correction = constrain(correction, -100, 100);

    return correction;
}
```

**å‚æ•°è¯´æ˜ï¼š**
| å‚æ•° | ä½œç”¨ | æ¨èèŒƒå›´ | è°ƒå‚é¡ºåº |
|------|------|----------|----------|
| `kp` | æ–¹å‘ç¯æ¯”ä¾‹ç³»æ•° | 2.0-4.0 | â‘¡ |
| `kd` | æ–¹å‘ç¯å¾®åˆ†ç³»æ•° | 0.5-1.5 | â‘¡ |
| `kp_gyro` | è§’é€Ÿåº¦ç¯æ¯”ä¾‹ç³»æ•° | 0.8-2.0 | â‘ ï¼ˆå…ˆè°ƒï¼‰ |
| `kd_gyro` | è§’é€Ÿåº¦ç¯å¾®åˆ†ç³»æ•° | 0.2-0.5 | â‘ ï¼ˆå…ˆè°ƒï¼‰ |

**è°ƒå‚åŸåˆ™ï¼š** å…ˆè°ƒå†…ç¯ï¼ˆè§’é€Ÿåº¦ç¯ï¼‰ï¼Œå†è°ƒå¤–ç¯ï¼ˆæ–¹å‘ç¯ï¼‰

---

### 4ï¸âƒ£ ä¼ æ„Ÿå™¨æœ‰æ•ˆæ€§æ£€æŸ¥

**æ–‡ä»¶ä½ç½®ï¼š** `code/task.c:15-37`

**æ£€æŸ¥é€»è¾‘ï¼š**
```c
uint8 sensor_check_valid(void)
{
    // åˆ¤æ–­1: å…¨é»‘æ£€æµ‹ï¼ˆå¯èƒ½è„±ç¦»èµ›é“ï¼‰
    if(adc_normalized_list[1] > 48 &&
       adc_normalized_list[2] > 48 &&
       adc_normalized_list[3] > 48)
        return 0;  // ä¼ æ„Ÿå™¨æ— æ•ˆ

    // åˆ¤æ–­2: å…¨ç™½æ£€æµ‹ï¼ˆå¯èƒ½èµ·é£æˆ–ä¼ æ„Ÿå™¨æ•…éšœï¼‰
    if(adc_normalized_list[1] < 2 &&
       adc_normalized_list[2] < 2 &&
       adc_normalized_list[3] < 2)
        return 0;  // ä¼ æ„Ÿå™¨æ— æ•ˆ

    return 1;  // ä¼ æ„Ÿå™¨æœ‰æ•ˆ
}
```

**å¼‚å¸¸å¤„ç†ç­–ç•¥ï¼š**
- **æ¨¡å¼1 (SDSD)ï¼š** ä¿æŒä¸Šä¸€æ¬¡çš„PIDè¾“å‡º
- **æ¨¡å¼2 (PD)ï¼š** ä½¿ç”¨IMUè§’é€Ÿåº¦è´Ÿåé¦ˆä¿æŒç›´è¡Œ

---

## å®Œæ•´æµ‹è¯•æ–¹æ¡ˆ

### âš ï¸ æµ‹è¯•å‰å‡†å¤‡

#### ç¡¬ä»¶æ£€æŸ¥æ¸…å•
- [ ] ç”µæœºé©±åŠ¨è¿æ¥æ­£ç¡®ï¼ˆå·¦å³ç”µæœºæ–¹å‘æ­£ç¡®ï¼‰
- [ ] ç¼–ç å™¨è¿æ¥æ­£ç¡®ï¼ˆA/Bç›¸ä¸æ¥åï¼‰
- [ ] 5è·¯ADCä¼ æ„Ÿå™¨å®‰è£…ä½ç½®æ­£ç¡®ï¼ˆä»å·¦åˆ°å³ï¼š0-4ï¼‰
- [ ] IMU660RBå®‰è£…ç¨³å›ºï¼Œæ–¹å‘æ­£ç¡®
- [ ] ç”µæºä¾›ç”µç¨³å®šï¼ˆå»ºè®®7.4Vé”‚ç”µæ± ï¼‰

#### ç¼–è¯‘é…ç½®
- **èŠ¯ç‰‡å‹å·ï¼š** STC32G12K128
- **æ—¶é’Ÿé¢‘ç‡ï¼š** 30MHz
- **ç¼–è¯‘å™¨ï¼š** C251ï¼ˆKeilï¼‰

---

### é˜¶æ®µ0ï¸âƒ£: ç¡¬ä»¶è¿æ¥æµ‹è¯•

#### æµ‹è¯•1: ç”µæœºé©±åŠ¨æµ‹è¯•

**æµ‹è¯•ä»£ç ï¼ˆä¸´æ—¶æ·»åŠ åˆ°main.cä¸»å¾ªç¯ï¼‰ï¼š**
```c
// ç”µæœºæ­£è½¬æµ‹è¯•
Motor_LeftForward(20);
Motor_RightForward(20);
system_delay_ms(2000);

// ç”µæœºåè½¬æµ‹è¯•
Motor_LeftBackward(20);
Motor_RightBackward(20);
system_delay_ms(2000);
```

**æœŸæœ›ç»“æœï¼š**
| æ“ä½œ | æœŸæœ›è¡Œä¸º |
|------|----------|
| æ­£è½¬æµ‹è¯• | ä¸¤è½®å‘å‰è½¬åŠ¨ï¼Œé€Ÿåº¦ä¸€è‡´ |
| åè½¬æµ‹è¯• | ä¸¤è½®å‘åè½¬åŠ¨ï¼Œé€Ÿåº¦ä¸€è‡´ |

**æ•…éšœæ’æŸ¥ï¼š**
| é—®é¢˜ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ³• |
|------|----------|----------|
| ç”µæœºä¸è½¬ | PWM/æ–¹å‘å¼•è„šé…ç½®é”™è¯¯ | æ£€æŸ¥ `motor.h` å¼•è„šå®šä¹‰ |
| å•è¾¹ä¸è½¬ | é©±åŠ¨æ¨¡å—æŸå/æ¥çº¿é”™è¯¯ | æ£€æŸ¥ç”µæœºé©±åŠ¨æ¿ |
| æ–¹å‘åäº† | æ–¹å‘å¼•è„šç”µå¹³é”™è¯¯ | äº¤æ¢ `Motor_LeftForward/Backward` |

---

#### æµ‹è¯•2: ç¼–ç å™¨æµ‹è¯•

**æµ‹è¯•ä»£ç ï¼ˆæ·»åŠ åˆ°ä¸»å¾ªç¯ï¼‰ï¼š**
```c
// æ‰“å°ç¼–ç å™¨å€¼
Encoder_Get_Filtered();
printf("Encoder L: %d, R: %d\r\n", encoder_data_dir_L, encoder_data_dir_R);
system_delay_ms(100);
```

**æœŸæœ›ç»“æœï¼š**
| æ“ä½œ | æœŸæœ›è¾“å‡º |
|------|----------|
| æ‰‹åŠ¨è½¬åŠ¨å·¦è½®å‘å‰ | Encoder L: æ­£å€¼ |
| æ‰‹åŠ¨è½¬åŠ¨å·¦è½®å‘å | Encoder L: è´Ÿå€¼ |
| æ‰‹åŠ¨è½¬åŠ¨å³è½®å‘å‰ | Encoder R: æ­£å€¼ |
| æ‰‹åŠ¨è½¬åŠ¨å³è½®å‘å | Encoder R: è´Ÿå€¼ |

**æ•…éšœæ’æŸ¥ï¼š**
| é—®é¢˜ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ³• |
|------|----------|----------|
| ç¼–ç å™¨å€¼å§‹ç»ˆä¸º0 | ç¼–ç å™¨æœªåˆå§‹åŒ–/æ¥çº¿é”™è¯¯ | æ£€æŸ¥ `Encoder_Init()` |
| æ­£åè½¬ç¬¦å·åäº† | A/Bç›¸æ¥å | äº¤æ¢ç¼–ç å™¨A/Bç›¸ |

---

#### æµ‹è¯•3: ADCä¼ æ„Ÿå™¨æµ‹è¯•

**æµ‹è¯•ä»£ç ï¼ˆæ·»åŠ åˆ°ä¸»å¾ªç¯ï¼‰ï¼š**
```c
Adc_Getval_Fast();
Normalization();
printf("ADC: %d %d %d %d %d\r\n",
       adc_normalized_list[0], adc_normalized_list[1],
       adc_normalized_list[2], adc_normalized_list[3],
       adc_normalized_list[4]);
system_delay_ms(100);
```

**æœŸæœ›ç»“æœï¼š**
| ä¼ æ„Ÿå™¨ä½ç½® | å½’ä¸€åŒ–å€¼ | è¯´æ˜ |
|------------|----------|------|
| ç™½è‰²èƒŒæ™¯ | 0-10 | èµ›é“çº¿å¤–ï¼ˆæœ€äº®ï¼‰ |
| èµ›é“è¾¹ç¼˜ | 20-30 | é»‘ç™½äº¤ç•Œå¤„ |
| é»‘è‰²èµ›é“çº¿ | 40-50 | èµ›é“ä¸­å¿ƒçº¿ï¼ˆæœ€æš—ï¼‰ |

**ä¼ æ„Ÿå™¨æ ¡å‡†ï¼š**

ä¿®æ”¹ `code/adc.c:20-26`ï¼š
```c
uint16 max_min_adc[2*CHANNEL_NUMBER] = {
    3500, 500,   // L1: ç™½è‰²æœ€å¤§å€¼, é»‘è‰²æœ€å°å€¼ï¼ˆéœ€å®æµ‹ï¼‰
    3520, 520,   // L2
    3550, 480,   // M3
    3510, 510,   // R4
    3540, 490,   // R5
};
```

**æ ¡å‡†æ­¥éª¤ï¼š**
1. å°è½¦æ”¾åœ¨**ç™½è‰²èƒŒæ™¯**ä¸Šï¼Œè®°å½•5ä¸ªä¼ æ„Ÿå™¨çš„ADCå€¼ â†’ å¡«å…¥å¶æ•°ç´¢å¼•
2. å°è½¦æ”¾åœ¨**é»‘è‰²èµ›é“çº¿**ä¸Šï¼Œè®°å½•5ä¸ªä¼ æ„Ÿå™¨çš„ADCå€¼ â†’ å¡«å…¥å¥‡æ•°ç´¢å¼•
3. é‡æ–°ç¼–è¯‘ä¸‹è½½

---

#### æµ‹è¯•4: IMUä¼ æ„Ÿå™¨æµ‹è¯•

**æµ‹è¯•ä»£ç ï¼ˆæ·»åŠ åˆ°ä¸»å¾ªç¯ï¼‰ï¼š**
```c
printf("IMU Yaw: %.2f, GyroZ: %.2f\r\n", imu.yaw, imu.gyro_z);
system_delay_ms(100);
```

**æœŸæœ›ç»“æœï¼š**
| æ“ä½œ | æœŸæœ›è¾“å‡º |
|------|----------|
| æ°´å¹³é™æ­¢ | Yaw: æ¥è¿‘0, GyroZ: æ¥è¿‘0 |
| å‘å·¦æ—‹è½¬ | Yawå‡å°, GyroZ: è´Ÿå€¼ |
| å‘å³æ—‹è½¬ | Yawå¢å¤§, GyroZ: æ­£å€¼ |

**æ•…éšœæ’æŸ¥ï¼š**
| é—®é¢˜ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ³• |
|------|----------|----------|
| IMUåˆå§‹åŒ–å¤±è´¥ | I2Cé€šä¿¡é”™è¯¯ | æ£€æŸ¥I2Cå¼•è„šè¿æ¥ |
| æ•°æ®ä¸æ›´æ–° | ä¸­æ–­æœªå¯ç”¨ | æ£€æŸ¥ `imu_update_task()` è°ƒç”¨ |

---

### é˜¶æ®µ1ï¸âƒ£: æ¨¡å¼0æµ‹è¯• - çº¯PIDé€Ÿåº¦ç¯

#### æµ‹è¯•ç›®çš„
éªŒè¯é€Ÿåº¦ç¯PIDå·¥ä½œæ­£å¸¸ï¼Œå·¦å³è½®é€Ÿåº¦ä¸€è‡´

#### é…ç½®æ–¹æ³•
ä¿®æ”¹ `code/task.h:30`ï¼š
```c
#define CONTROL_MODE_CURRENT  CONTROL_MODE_PID_ONLY
```

#### æµ‹è¯•æ­¥éª¤

**Step 1: ç¼–è¯‘ä¸‹è½½ç¨‹åº**
1. ç¼–è¯‘é¡¹ç›®ï¼ˆç¡®ä¿æ— é”™è¯¯ï¼‰
2. ä¸‹è½½åˆ°STC32G
3. æ‰“å¼€ä¸²å£ç›‘è§†å™¨ï¼ˆæ³¢ç‰¹ç‡115200ï¼‰

**Step 2: è§‚å¯Ÿä¸²å£è¾“å‡º**
```
IMU init success!
Encoder L: 28, R: 29
Encoder L: 30, R: 31
Encoder L: 29, R: 30
```

**æœŸæœ›ç»“æœï¼š**
- ç¼–ç å™¨å€¼ç¨³å®šåœ¨ç›®æ ‡å€¼é™„è¿‘ï¼ˆé»˜è®¤30ï¼‰
- å·¦å³è½®è¯¯å·®åœ¨Â±5ä»¥å†…
- è½¦è½®å¹³ç¨³è½¬åŠ¨ï¼Œæ— æŠ–åŠ¨

**Step 3: è°ƒæ•´ç›®æ ‡é€Ÿåº¦**

ä¿®æ”¹ `user/main.c:90-91`ï¼š
```c
pid_set_target(&pid_motor_left, 50.0f);   // å¢å¤§ç›®æ ‡é€Ÿåº¦
pid_set_target(&pid_motor_right, 50.0f);
```

**ç›®æ ‡é€Ÿåº¦å‚è€ƒï¼š**
| é€Ÿåº¦å€¼ | è½¦é€Ÿ | é€‚ç”¨åœºæ™¯ |
|--------|------|----------|
| 20-30 | æ…¢é€Ÿ | æµ‹è¯•/è°ƒè¯• |
| 40-60 | ä¸­é€Ÿ | æ™®é€šå¾ªè¿¹ |
| 70-100 | å¿«é€Ÿ | ç«é€Ÿæ¨¡å¼ |

#### æ•…éšœæ’æŸ¥

| é—®é¢˜ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ³• |
|------|----------|----------|
| ç”µæœºä¸è½¬ | ç›®æ ‡é€Ÿåº¦æœªè®¾ç½® | æ£€æŸ¥ `pid_set_target()` |
| å·¦å³è½®é€Ÿåº¦ä¸ä¸€è‡´ | PIDå‚æ•°ä¸åŒ¹é… | è°ƒæ•´ `pid_init()` å‚æ•° |
| é€Ÿåº¦æŠ–åŠ¨ | Kpè¿‡å¤§ | å‡å°é€Ÿåº¦ç¯Kp |
| åŠ é€Ÿè¿‡æ…¢ | Kiè¿‡å° | å¢å¤§é€Ÿåº¦ç¯Ki |

#### æˆåŠŸæ ‡å¿—
- âœ… å·¦å³è½®ä»¥ç›¸åŒé€Ÿåº¦ç¨³å®šè½¬åŠ¨
- âœ… ç¼–ç å™¨åé¦ˆå€¼æ¥è¿‘ç›®æ ‡å€¼ï¼ˆè¯¯å·®<10%ï¼‰
- âœ… æ— æ˜æ˜¾æŠ–åŠ¨æˆ–å¼‚å“
- âœ… åŠ å‡é€Ÿå¹³æ»‘

---

### é˜¶æ®µ2ï¸âƒ£: æ¨¡å¼1æµ‹è¯• - SDSDå¾ªè¿¹

#### æµ‹è¯•ç›®çš„
éªŒè¯SDSDç®—æ³•å’Œä¼ æ„Ÿå™¨æœ‰æ•ˆæ€§æ£€æŸ¥

#### é…ç½®æ–¹æ³•
ä¿®æ”¹ `code/task.h:30`ï¼š
```c
#define CONTROL_MODE_CURRENT  CONTROL_MODE_SDSD
```

#### æµ‹è¯•æ­¥éª¤

**Step 1: é™æ€æµ‹è¯•ï¼ˆå°è½¦ä¿æŒä¸åŠ¨ï¼‰**

å°†å°è½¦æ”¾åœ¨èµ›é“ä¸åŒä½ç½®ï¼Œè§‚å¯Ÿä¸²å£è¾“å‡ºï¼š

```c
// ä¸´æ—¶æ·»åŠ è°ƒè¯•ä»£ç 
Adc_Getval_Fast();
Normalization();
float sdsd_val = SDSD_calculate(&SDSD);
printf("Norm: %d %d %d %d %d | SDSD: %.2f\r\n",
       adc_normalized_list[0], adc_normalized_list[1],
       adc_normalized_list[2], adc_normalized_list[3],
       adc_normalized_list[4], sdsd_val);
```

**æœŸæœ›ç»“æœï¼š**
| å°è½¦ä½ç½® | ä¼ æ„Ÿå™¨å€¼(ç¤ºä¾‹) | SDSDè¾“å‡º | ä¿®æ­£æ–¹å‘ |
|----------|----------------|----------|----------|
| å±…ä¸­ | 5 8 48 10 6 | æ¥è¿‘0 | æ— ä¿®æ­£ |
| åå·¦ | 25 48 45 5 3 | è´Ÿæ•°(-20~-50) | å³è½¬ |
| åå³ | 3 5 47 46 24 | æ­£æ•°(+20~+50) | å·¦è½¬ |

**Step 2: åŠ¨æ€å¾ªè¿¹æµ‹è¯•**

å°†å°è½¦æ”¾åœ¨èµ›é“èµ·ç‚¹ï¼Œè®©å…¶è‡ªåŠ¨å¾ªè¿¹

**åˆå§‹å‚æ•°ï¼š** `user/main.c:80-82`
```c
SDSD_init(&SDSD, 1.0f, 1.0f, 1.0f);        // A=B=C=1.0
pid_init(&pid_SDSD, 2.0f, 0.0f, 0.5f);     // Kp=2.0, Ki=0, Kd=0.5
```

**æµ‹è¯•ç°è±¡è®°å½•è¡¨ï¼š**

| ç°è±¡ | å¯èƒ½åŸå›  | è°ƒæ•´æ–¹æ¡ˆ |
|------|----------|----------|
| å¾ªè¿¹æ­£å¸¸ | å‚æ•°åˆé€‚ | æ— éœ€è°ƒæ•´ âœ… |
| å“åº”å¤ªæ…¢ | SDSDç³»æ•°è¿‡å° | å¢å¤§A,B |
| è½¬å¼¯ä¸è¶³ | Kpè¿‡å° | å¢å¤§Kpåˆ°2.5-3.0 |
| éœ‡è¡/è¶…è°ƒ | Kpæˆ–Kdè¿‡å¤§ | å‡å°Kpåˆ°1.5, Kdåˆ°0.3 |
| ç›´çº¿æŠ–åŠ¨ | Kdè¿‡å¤§ | å‡å°Kdåˆ°0.2 |
| æ— æ³•è¯†åˆ«èµ›é“ | ADCæœªæ ¡å‡† | é‡æ–°æ ¡å‡†max_min_adc |

#### å‚æ•°è°ƒä¼˜é¡ºåº

**1. å…ˆè°ƒSDSDç³»æ•°ï¼ˆA, B, Cï¼‰**
```c
// å¦‚æœå¾ªè¿¹å“åº”å¤ªæ…¢ï¼ˆè½¬å¼¯ä¸åŠæ—¶ï¼‰
SDSD_init(&SDSD, 1.5f, 1.2f, 0.8f);  // å¢å¤§A,B

// å¦‚æœå¾ªè¿¹æŠ–åŠ¨ä¸¥é‡
SDSD_init(&SDSD, 0.8f, 0.6f, 1.2f);  // å‡å°A,B, å¢å¤§C

// å¦‚æœç›´çº¿æ®µä¸ç¨³å®š
SDSD_init(&SDSD, 1.0f, 1.0f, 1.5f);  // å¢å¤§C
```

**2. å†è°ƒPIDå‚æ•°**
```c
// å¦‚æœè½¬å¼¯ä¿®æ­£ä¸è¶³
pid_init(&pid_SDSD, 3.0f, 0.0f, 0.8f);  // å¢å¤§Kp, Kd

// å¦‚æœéœ‡è¡/è¶…è°ƒ
pid_init(&pid_SDSD, 1.5f, 0.0f, 0.3f);  // å‡å°Kp, Kd

// å¦‚æœç›´çº¿æ®µæŠ–åŠ¨
pid_init(&pid_SDSD, 2.0f, 0.0f, 0.2f);  // å‡å°Kd
```

#### æˆåŠŸæ ‡å¿—
- âœ… å°è½¦èƒ½ç¨³å®šæ²¿èµ›é“ä¸­å¿ƒçº¿è¡Œé©¶
- âœ… è½¬å¼¯æ—¶å¹³æ»‘è¿‡æ¸¡ï¼Œæ— å‰§çƒˆéœ‡è¡
- âœ… ç›´çº¿æ®µæ— æ˜æ˜¾æŠ–åŠ¨
- âœ… èƒ½å®Œæˆå®Œæ•´èµ›é“å¾ªè¿¹

---

### é˜¶æ®µ3ï¸âƒ£: æ¨¡å¼2æµ‹è¯• - PDæ–¹å‘ç¯+è§’é€Ÿåº¦ç¯

#### æµ‹è¯•ç›®çš„
éªŒè¯IMUæ•°æ®å’ŒåŒç¯PDæ§åˆ¶

#### é…ç½®æ–¹æ³•
ä¿®æ”¹ `code/task.h:30`ï¼š
```c
#define CONTROL_MODE_CURRENT  CONTROL_MODE_PD_DIRECTION
```

#### æµ‹è¯•æ­¥éª¤

**Step 1: IMUæ•°æ®éªŒè¯**

```c
// ä¸²å£æ‰“å°IMUæ•°æ®
printf("Yaw: %.2f, GyroZ: %.2f\r\n", imu.yaw, imu.gyro_z);
```

**æœŸæœ›ç»“æœï¼š**
| æ“ä½œ | GyroZå€¼ | è¯´æ˜ |
|------|---------|------|
| æ°´å¹³é™æ­¢ | æ¥è¿‘0 | è§’é€Ÿåº¦ä¸º0 |
| å‘å·¦æ—‹è½¬ | è´Ÿå€¼ï¼ˆ-10~-50ï¼‰ | è´Ÿè§’é€Ÿåº¦ |
| å‘å³æ—‹è½¬ | æ­£å€¼ï¼ˆ+10~+50ï¼‰ | æ­£è§’é€Ÿåº¦ |

**Step 2: é™æ€æµ‹è¯•ï¼ˆå°è½¦ä¿æŒä¸åŠ¨ï¼‰**

å°†å°è½¦æ”¾åœ¨èµ›é“ä¸åŒä½ç½®ï¼Œè§‚å¯Ÿä¿®æ­£å€¼ï¼š

```c
// ä¸´æ—¶æ·»åŠ è°ƒè¯•ä»£ç 
float err = position_error_calc();
printf("Err: %.2f, GyroZ: %.2f, Correction: %.2f\r\n",
       err, imu.gyro_z, pd_direction_gyro_loop(err));
```

**æœŸæœ›ç»“æœï¼š**
| å°è½¦ä½ç½® | ä½ç½®è¯¯å·® | æœŸæœ›è§’é€Ÿåº¦ | å®é™…è¡Œä¸º |
|----------|----------|------------|----------|
| å±…ä¸­ | 0 | 0 | ä¿æŒç›´è¡Œ |
| åå·¦ | è´Ÿæ•°(-20) | æ­£è§’é€Ÿåº¦(+40Â°/s) | å³è½¬ä¿®æ­£ |
| åå³ | æ­£æ•°(+20) | è´Ÿè§’é€Ÿåº¦(-40Â°/s) | å·¦è½¬ä¿®æ­£ |

**Step 3: åŠ¨æ€æµ‹è¯•**

**åˆå§‹å‚æ•°ï¼š** `user/main.c:95`
```c
pd_init(&pd_direction, 2.5f, 0.8f, 1.2f, 0.3f);
// æ–¹å‘ç¯: Kp=2.5, Kd=0.8
// è§’é€Ÿåº¦ç¯: Kp_gyro=1.2, Kd_gyro=0.3
```

**è°ƒå‚é¡ºåºï¼ˆå…ˆå†…ç¯åå¤–ç¯ï¼‰ï¼š**

**Step 3.1: è°ƒæ•´è§’é€Ÿåº¦ç¯ï¼ˆå†…ç¯ï¼‰**
```c
// æµ‹è¯•æ–¹æ³•ï¼šæ‰‹åŠ¨æ—‹è½¬å°è½¦åæ¾æ‰‹ï¼Œè§‚å¯Ÿæ¢å¤é€Ÿåº¦

// å¦‚æœæ¢å¤å¤ªæ…¢
pd_init(&pd_direction, 2.5f, 0.8f, 2.0f, 0.5f);  // å¢å¤§kp_gyro, kd_gyro

// å¦‚æœéœ‡è¡
pd_init(&pd_direction, 2.5f, 0.8f, 0.8f, 0.2f);  // å‡å°kp_gyro, kd_gyro
```

**Step 3.2: è°ƒæ•´æ–¹å‘ç¯ï¼ˆå¤–ç¯ï¼‰**
```c
// å¦‚æœå¾ªè¿¹å“åº”æ…¢
pd_init(&pd_direction, 3.5f, 1.2f, 1.2f, 0.3f);  // å¢å¤§Kp, Kd

// å¦‚æœæŠ–åŠ¨
pd_init(&pd_direction, 2.0f, 0.5f, 1.2f, 0.3f);  // å‡å°Kp, Kd
```

#### æµ‹è¯•ç°è±¡è®°å½•è¡¨

| ç°è±¡ | å¯èƒ½åŸå›  | è°ƒæ•´æ–¹æ¡ˆ |
|------|----------|----------|
| å¾ªè¿¹æ­£å¸¸ | å‚æ•°åˆé€‚ | æ— éœ€è°ƒæ•´ âœ… |
| è½¬å¼¯å“åº”æ…¢ | Kpæˆ–kp_gyroè¿‡å° | å¢å¤§Kpæˆ–kp_gyro |
| éœ‡è¡/æŠ–åŠ¨ | Kdæˆ–kd_gyroè¿‡å¤§ | å‡å°Kdæˆ–kd_gyro |
| æ— æ³•ä¿æŒç›´è¡Œ | IMUæ•°æ®å¼‚å¸¸ | æ£€æŸ¥IMUåˆå§‹åŒ– |
| è½¬å¼¯è¿‡åº¦ | Kpè¿‡å¤§ | å‡å°Kp |

#### æˆåŠŸæ ‡å¿—
- âœ… å°è½¦å¾ªè¿¹ç¨³å®šï¼Œå“åº”å¿«é€Ÿ
- âœ… è½¬å¼¯å¹³æ»‘ï¼Œæ— è¶…è°ƒ
- âœ… IMUè§’é€Ÿåº¦é—­ç¯æœ‰æ•ˆå·¥ä½œ
- âœ… èƒ½å®Œæˆå¤æ‚èµ›é“å¾ªè¿¹

---

## å‚æ•°è°ƒä¼˜æŒ‡å—

### ç”µæœºé€Ÿåº¦ç¯PID

**ä½ç½®ï¼š** `user/main.c:85-86`

**åˆå§‹å‚æ•°ï¼š**
```c
pid_init(&pid_motor_left, 1.7f, 0.22f, 0.2f);
pid_init(&pid_motor_right, 1.7f, 0.1f, 0.0f);
```

**è°ƒå‚è§„åˆ™ï¼š**

| ç°è±¡ | è°ƒæ•´Kp | è°ƒæ•´Ki | è°ƒæ•´Kd |
|------|--------|--------|--------|
| å“åº”æ…¢ | å¢å¤§ | å¢å¤§ | - |
| é€Ÿåº¦æŠ–åŠ¨ | å‡å° | - | å¢å¤§ |
| ç¨³æ€è¯¯å·®å¤§ | - | å¢å¤§ | - |
| è¶…è°ƒä¸¥é‡ | å‡å° | å‡å° | å¢å¤§ |

**æ¨èèŒƒå›´ï¼š**
- **Kp:** 1.0-3.0
- **Ki:** 0.1-0.5
- **Kd:** 0.0-0.5

---

### SDSDç³»æ•°

**ä½ç½®ï¼š** `user/main.c:80`

**åˆå§‹å‚æ•°ï¼š**
```c
SDSD_init(&SDSD, 1.0f, 1.0f, 1.0f);
```

**å‚æ•°å«ä¹‰ï¼š**
| å‚æ•° | ä½œç”¨ä¼ æ„Ÿå™¨ | æ¨èèŒƒå›´ | è¯´æ˜ |
|------|------------|----------|------|
| **A** | å¤–å±‚(0,4) | 0.5-1.5 | æ§åˆ¶è¾¹ç¼˜ä¼ æ„Ÿå™¨å½±å“ |
| **B** | å†…å±‚(1,3) | 0.5-1.5 | æ§åˆ¶è¿‘ä¸­å¿ƒä¼ æ„Ÿå™¨å½±å“ |
| **C** | ä¸­å¿ƒ(2) | 0.5-1.5 | æ§åˆ¶å½’ä¸€åŒ–æƒé‡ |

**è°ƒå‚è§„åˆ™ï¼š**
- **å¢å¤§Aã€Bï¼š** æé«˜å“åº”é€Ÿåº¦ï¼Œä½†å¯èƒ½å¼•èµ·éœ‡è¡
- **å¢å¤§Cï¼š** æé«˜ç›´çº¿ç¨³å®šæ€§ï¼Œä½†å“åº”å˜æ…¢
- **æ¨èé¡ºåºï¼š** å…ˆè°ƒA=B=C=1.0ï¼Œå†æ ¹æ®è¡¨ç°å¾®è°ƒ

---

### SDSDçš„PID

**ä½ç½®ï¼š** `user/main.c:81`

**åˆå§‹å‚æ•°ï¼š**
```c
pid_init(&pid_SDSD, 2.0f, 0.0f, 0.5f);
```

**è°ƒå‚è§„åˆ™ï¼š**

| ç°è±¡ | è°ƒæ•´Kp | è°ƒæ•´Ki | è°ƒæ•´Kd |
|------|--------|--------|--------|
| è½¬å¼¯ä¸è¶³ | å¢å¤§(2.5-3.5) | - | - |
| éœ‡è¡/è¶…è°ƒ | å‡å°(1.0-1.5) | - | - |
| ç›´çº¿æŠ–åŠ¨ | - | - | å‡å°(0.2-0.3) |
| å“åº”æ…¢ | å¢å¤§ | - | å¢å¤§ |

**æ¨èèŒƒå›´ï¼š**
- **Kp:** 1.5-3.5
- **Ki:** 0ï¼ˆé€šå¸¸ä¸éœ€è¦ç§¯åˆ†ï¼‰
- **Kd:** 0.2-0.8

---

### PDæ–¹å‘ç¯+è§’é€Ÿåº¦ç¯

**ä½ç½®ï¼š** `user/main.c:95`

**åˆå§‹å‚æ•°ï¼š**
```c
pd_init(&pd_direction, 2.5f, 0.8f, 1.2f, 0.3f);
//                    Kp   Kd    Kp_gyro Kd_gyro
```

**è°ƒå‚é¡ºåºï¼š** å…ˆè°ƒå†…ç¯ï¼ˆè§’é€Ÿåº¦ç¯ï¼‰ï¼Œå†è°ƒå¤–ç¯ï¼ˆæ–¹å‘ç¯ï¼‰

#### 1. è§’é€Ÿåº¦ç¯è°ƒå‚ï¼ˆå†…ç¯ï¼‰

**æµ‹è¯•æ–¹æ³•ï¼š** æ‰‹åŠ¨æ—‹è½¬å°è½¦åæ¾æ‰‹ï¼Œè§‚å¯Ÿæ¢å¤é€Ÿåº¦

| ç°è±¡ | è°ƒæ•´kp_gyro | è°ƒæ•´kd_gyro |
|------|-------------|-------------|
| æ¢å¤å¤ªæ…¢ | å¢å¤§(1.5-2.5) | - |
| éœ‡è¡ | å‡å°(0.8-1.2) | å‡å°(0.2-0.3) |
| å“åº”æ…¢ | - | å¢å¤§(0.4-0.6) |

**æ¨èèŒƒå›´ï¼š**
- **kp_gyro:** 0.8-2.5
- **kd_gyro:** 0.2-0.6

#### 2. æ–¹å‘ç¯è°ƒå‚ï¼ˆå¤–ç¯ï¼‰

**æµ‹è¯•æ–¹æ³•ï¼š** èµ›é“å¾ªè¿¹æµ‹è¯•

| ç°è±¡ | è°ƒæ•´Kp | è°ƒæ•´Kd |
|------|-------|-------|
| è½¬å¼¯å“åº”æ…¢ | å¢å¤§(3.0-4.0) | - |
| è½¬å¼¯è¿‡åº¦ | å‡å°(2.0-2.5) | - |
| éœ‡è¡/æŠ–åŠ¨ | å‡å° | å¢å¤§(1.0-1.5) |
| å“åº”æ…¢ | - | å‡å°(0.5-0.8) |

**æ¨èèŒƒå›´ï¼š**
- **Kp:** 2.0-4.0
- **Kd:** 0.5-1.5

---

## å¸¸è§é—®é¢˜æ’æŸ¥

### 1ï¸âƒ£ ç”µæœºç›¸å…³é—®é¢˜

| é—®é¢˜ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ³• |
|------|----------|----------|
| ç”µæœºä¸è½¬ | ç›®æ ‡é€Ÿåº¦ä¸º0 | æ£€æŸ¥ `pid_set_target()` è°ƒç”¨ |
| å•è¾¹è½¬åŠ¨ | ç¼–ç å™¨æ¥çº¿åäº† | äº¤æ¢ç¼–ç å™¨A/Bç›¸ |
| é€Ÿåº¦ä¸ä¸€è‡´ | PIDå‚æ•°ä¸åŒ¹é… | è°ƒæ•´å·¦å³è½®ç‹¬ç«‹å‚æ•° |
| ç”µæœºæŠ–åŠ¨ | Kpè¿‡å¤§ | å‡å°é€Ÿåº¦ç¯Kp |
| åŠ é€Ÿè¿‡æ…¢ | Kiè¿‡å° | å¢å¤§é€Ÿåº¦ç¯Ki |

---

### 2ï¸âƒ£ ä¼ æ„Ÿå™¨ç›¸å…³é—®é¢˜

| é—®é¢˜ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ³• |
|------|----------|----------|
| æ— æ³•è¯†åˆ«èµ›é“ | ADCæœªæ ¡å‡† | é‡æ–°æ ¡å‡† `max_min_adc[]` |
| å…¨é»‘æ—¶ä¸å·¥ä½œ | ä¼ æ„Ÿå™¨é˜ˆå€¼å¤ªä¸¥ | è°ƒæ•´ `sensor_check_valid()` |
| å…¨ç™½æ—¶ä¸å·¥ä½œ | ä¼ æ„Ÿå™¨é˜ˆå€¼å¤ªä¸¥ | è°ƒæ•´ `sensor_check_valid()` |
| å½’ä¸€åŒ–å€¼å¼‚å¸¸ | max/minå€¼é”™è¯¯ | æ£€æŸ¥æ ¡å‡†æ•°æ® |
| ä¼ æ„Ÿå™¨å™ªå£°å¤§ | æ»¤æ³¢ä¸è¶³ | ä½¿ç”¨ `Adc_Getval_Avg()` |

---

### 3ï¸âƒ£ å¾ªè¿¹ç›¸å…³é—®é¢˜

| é—®é¢˜ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ³• |
|------|----------|----------|
| æ— æ³•å¾ªè¿¹ | æ¨¡å¼é€‰æ‹©é”™è¯¯ | æ£€æŸ¥ `CONTROL_MODE_CURRENT` |
| å“åº”å¤ªæ…¢ | å‚æ•°è¿‡å° | å¢å¤§SDSDç³»æ•°æˆ–PIDçš„Kp |
| éœ‡è¡/è¶…è°ƒ | å‚æ•°è¿‡å¤§ | å‡å°Kpæˆ–Kd |
| ç›´çº¿æŠ–åŠ¨ | Kdè¿‡å¤§ | å‡å°Kd |
| è½¬å¼¯ä¸è¶³ | Kpè¿‡å° | å¢å¤§Kp |
| æ— æ³•è„±å›° | å¼‚å¸¸å¤„ç†é—®é¢˜ | æ£€æŸ¥ `sensor_check_valid()` |

---

### 4ï¸âƒ£ IMUç›¸å…³é—®é¢˜

| é—®é¢˜ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ³• |
|------|----------|----------|
| IMUåˆå§‹åŒ–å¤±è´¥ | I2Cé€šä¿¡é”™è¯¯ | æ£€æŸ¥I2Cå¼•è„šè¿æ¥ |
| æ•°æ®ä¸æ›´æ–° | ä¸­æ–­æœªå¯ç”¨ | æ£€æŸ¥å®šæ—¶å™¨é…ç½® |
| yawå€¼æ¼‚ç§» | é™æ€åç½® | é‡æ–°æ ¡å‡†IMU |
| gyro_zå¼‚å¸¸ | å®‰è£…æ–¹å‘é”™è¯¯ | è°ƒæ•´IMUå®‰è£…æ–¹å‘ |

---

### 5ï¸âƒ£ ç¼–è¯‘ç›¸å…³é—®é¢˜

| é—®é¢˜ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ³• |
|------|----------|----------|
| C25ç¼–è¯‘é”™è¯¯ | è¯­æ³•ä¸ç¬¦åˆC89 | ä¿®æ”¹ä¸ºæ ‡å‡†Cè¯­æ³• |
| å˜é‡å£°æ˜é”™è¯¯ | ä¸­é—´å£°æ˜å˜é‡ | ç§»åˆ°å‡½æ•°å¼€å¤´ |
| é“¾æ¥é”™è¯¯ | å‡½æ•°æœªå£°æ˜ | æ£€æŸ¥å¤´æ–‡ä»¶åŒ…å« |

---

## æµ‹è¯•è®°å½•è¡¨

å»ºè®®ä½¿ç”¨ä»¥ä¸‹è¡¨æ ¼è®°å½•æµ‹è¯•æ•°æ®ï¼š

### ç”µæœºæµ‹è¯•è®°å½•

| æµ‹è¯•é¡¹ | æ—¥æœŸ | ç›®æ ‡é€Ÿåº¦ | å·¦è½®å®é™… | å³è½®å®é™… | è¯¯å·® | ç»“æœ |
|--------|------|----------|----------|----------|------|------|
| ç”µæœºæµ‹è¯• | - | 30 | 28 | 29 | 2 | âœ… |
| é€Ÿåº¦è°ƒæ•´ | - | 50 | 48 | 49 | 2 | âœ… |

### SDSDå¾ªè¿¹è®°å½•

| æµ‹è¯•é¡¹ | æ—¥æœŸ | SDSDç³»æ•° | PIDå‚æ•° | æµ‹è¯•ç»“æœ | é—®é¢˜è®°å½• | è§£å†³æ–¹æ¡ˆ |
|--------|------|----------|---------|----------|----------|----------|
| åˆå§‹æµ‹è¯• | - | 1,1,1 | Kp=2,Kd=0.5 | âš ï¸ æŠ–åŠ¨ | Kpè¿‡å¤§ | Kpæ”¹ä¸º1.5 |
| è°ƒå‚å | - | 1.2,1,0.8 | Kp=1.5,Kd=0.3 | âœ… é€šè¿‡ | æ—  | - |

### PDæ–¹å‘ç¯è®°å½•

| æµ‹è¯•é¡¹ | æ—¥æœŸ | Kp,Kd | Kp_g,Kd_g | æµ‹è¯•ç»“æœ | é—®é¢˜è®°å½• | è§£å†³æ–¹æ¡ˆ |
|--------|------|-------|----------|----------|----------|----------|
| å†…ç¯æµ‹è¯• | - | - | 1.2,0.3 | âœ… é€šè¿‡ | æ—  | - |
| å¤–ç¯æµ‹è¯• | - | 2.5,0.8 | 1.2,0.3 | âœ… é€šè¿‡ | æ—  | - |

---

## é™„å½•

### A. é‡è¦æ–‡ä»¶ç´¢å¼•

| æ–‡ä»¶ | åŠŸèƒ½ | å…³é”®å‡½æ•° |
|------|------|----------|
| `task.c` | ä¸»æ§åˆ¶é€»è¾‘ | `motor_control_task()` |
| `pid.c` | PID/PDæ§åˆ¶å™¨ | `motor_pid_control()`<br>`pd_direction_gyro_loop()` |
| `control.c` | SDSDç®—æ³• | `SDSD_calculate()` |
| `encoder.c` | ç¼–ç å™¨+æ»¤æ³¢ | `Encoder_Get_Filtered()` |
| `adc.c` | ADCé‡‡é›† | `Adc_Getval_Fast()` |
| `normalization.c` | å½’ä¸€åŒ– | `Normalization()` |
| `motor.c` | ç”µæœºé©±åŠ¨ | `Motor_Left/RightForward/Backward()` |

---

### B. å‚æ•°å¿«é€Ÿå‚è€ƒ

**ç”µæœºé€Ÿåº¦ç¯ï¼š**
```c
pid_init(&pid_motor_left, 1.7f, 0.22f, 0.2f);
//       Kp        Ki    Kd
```

**SDSDï¼š**
```c
SDSD_init(&SDSD, 1.0f, 1.0f, 1.0f);
//             A      B      C
pid_init(&pid_SDSD, 2.0f, 0.0f, 0.5f);
//       Kp        Ki    Kd
```

**PDæ–¹å‘ç¯ï¼š**
```c
pd_init(&pd_direction, 2.5f, 0.8f, 1.2f, 0.3f);
//      Kp   Kd    Kp_gyro Kd_gyro
```

---

### C. è°ƒè¯•ä»£ç ç‰‡æ®µ

**æ‰“å°æ‰€æœ‰ä¼ æ„Ÿå™¨æ•°æ®ï¼š**
```c
Adc_Getval_Fast();
Normalization();
printf("ADC: %d %d %d %d %d\r\n",
       adc_normalized_list[0], adc_normalized_list[1],
       adc_normalized_list[2], adc_normalized_list[3],
       adc_normalized_list[4]);
```

**æ‰“å°ç¼–ç å™¨å’ŒIMUæ•°æ®ï¼š**
```c
printf("Enc L: %d, R: %d | Yaw: %.2f, GyroZ: %.2f\r\n",
       encoder_data_dir_L, encoder_data_dir_R,
       imu.yaw, imu.gyro_z);
```

**æ‰“å°SDSDè¾“å‡ºï¼š**
```c
float sdsd_val = SDSD_calculate(&SDSD);
printf("SDSD: %.2f\r\n", sdsd_val);
```

---

### D. è”ç³»ä¸æ”¯æŒ

**é¡¹ç›®ä»“åº“ï¼š** Elec3-5adc

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0
**æœ€åæ›´æ–°ï¼š** 2026-01-21

---

## æ€»ç»“

æœ¬æµ‹è¯•æŒ‡å—æ¶µç›–äº†STC32Gæ™ºèƒ½è½¦é¡¹ç›®çš„å®Œæ•´æµ‹è¯•æµç¨‹ï¼š

1. **ç¡¬ä»¶æµ‹è¯•** â†’ ç¡®ä¿æ‰€æœ‰ä¼ æ„Ÿå™¨å’Œæ‰§è¡Œå™¨æ­£å¸¸
2. **æ¨¡å¼0æµ‹è¯•** â†’ éªŒè¯é€Ÿåº¦ç¯PID
3. **æ¨¡å¼1æµ‹è¯•** â†’ éªŒè¯SDSDå¾ªè¿¹
4. **æ¨¡å¼2æµ‹è¯•** â†’ éªŒè¯PDæ–¹å‘ç¯+IMU

**æµ‹è¯•åŸåˆ™ï¼š**
- âœ… ä»ç®€å•åˆ°å¤æ‚ï¼Œé€æ­¥éªŒè¯
- âœ… å…ˆè°ƒå†…ç¯ï¼Œå†è°ƒå¤–ç¯
- âœ… æ¯æ¬¡åªè°ƒæ•´ä¸€ä¸ªå‚æ•°
- âœ… è®°å½•æµ‹è¯•æ•°æ®å’Œè°ƒæ•´è¿‡ç¨‹

ç¥ä½ è°ƒè¯•é¡ºåˆ©ï¼ğŸš—ğŸ’¨
